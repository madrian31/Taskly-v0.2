const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/login-0Nx25AUE.js","assets/vendor_react-BPssBI41.js","assets/vendor-DhMbaX6P.js","assets/vendor_firebase-BpY39YGu.js","assets/home-BViOqBRV.js","assets/App-DEF85R_q.css","assets/task-DrF2JJ4E.js","assets/task-CpPojvTB.css","assets/users-B4TRmNDu.js","assets/users-yjea5Z32.css","assets/dashboard-BBZhySKQ.js","assets/accessNotAvailable-DD23_pfr.js","assets/layout-Dh8T5Ih1.js","assets/layout-724H31W2.css","assets/main-layout-YlkRtq_F.js","assets/main-layout-BPKYgo-Z.css"])))=>i.map(i=>d[i]);
import{j as e,L as q,u as U,r as i,N as x,c as z,H as C,R as F,a as m}from"./vendor_react-BPssBI41.js";import{i as V,g as B,a as G,o as M,G as $,s as H,b as J,c as L,d as K,e as A,f as S,h as W,u as w,j as X,k as Y,l as E}from"./vendor_firebase-BpY39YGu.js";import"./vendor-DhMbaX6P.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}})();const Z="modulepreload",Q=function(a){return"/Taskly-v0.2/"+a},P={},h=function(t,s,c){let o=Promise.resolve();if(s&&s.length>0){let v=function(n){return Promise.all(n.map(d=>Promise.resolve(d).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=l?.nonce||l?.getAttribute("nonce");o=v(s.map(n=>{if(n=Q(n),n in P)return;P[n]=!0;const d=n.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${p}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":Z,d||(f.as="script"),f.crossOrigin="",f.href=n,u&&f.setAttribute("nonce",u),document.head.appendChild(f),d)return new Promise((R,g)=>{f.addEventListener("load",R),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${n}`)))})}))}function r(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return o.then(l=>{for(const u of l||[])u.status==="rejected"&&r(u.reason);return t().catch(r)})};function ee({id:a,children:t}){return e.jsx("section",{id:a,className:"section center",children:t})}function te(){return e.jsxs(ee,{children:[e.jsx("h1",{children:"Taskly"}),e.jsx(q,{to:"/login",children:"Get Started"})]})}const se={apiKey:"AIzaSyDbeHsZ1hrXAnCRePrfJFqkSDelKOGtqJU",authDomain:"taskly-2542f.firebaseapp.com",projectId:"taskly-2542f",storageBucket:"taskly-2542f.firebasestorage.app",messagingSenderId:"141937666380",appId:"1:141937666380:web:8a8aa08b12e2e4490887e9",measurementId:"G-MY6GLXVEPJ"},O=V(se),_=B(O),y=G(O);class re{onAuthStateChanged(t){return M(_,t)}async signInWithGoogle(){const t=new $;return await H(_,t)}async signOutUser(){await J(_)}getCurrentUser(){return _.currentUser}}const N=new re;function D(a,t){return{id:a,uid:t.uid??t.authUid??void 0,displayName:t.displayName??t.name,email:t.email,photoURL:t.photoURL,role:t.role??"user",department:t.department,status:t.status,lastActive:t.lastActive,createdAt:t.createdAt?.seconds?t.createdAt.seconds*1e3:t.createdAt??Date.now()}}class oe{constructor(){this.col=L(y,"users")}async getAll(){return(await K(this.col)).docs.map(s=>D(s.id,s.data()))}async getById(t){const s=A(y,"users",t),c=await S(s);return c.exists()?D(c.id,c.data()):null}async create(t){return(await W(L(y,"users"),{...t,createdAt:t.createdAt??Date.now()})).id}async upsertByUid(t,s){const c=A(y,"users",t);if((await S(c)).exists()){const r={updatedAt:E()};s.displayName!==void 0&&(r.displayName=s.displayName),s.email!==void 0&&(r.email=s.email),s.photoURL!==void 0&&(r.photoURL=s.photoURL),s.lastActive!==void 0&&(r.lastActive=s.lastActive),await w(c,r)}else await X(c,{...s,uid:t,role:s.role??"user",status:s.status??"active",createdAt:E(),updatedAt:E()})}async update(t,s){await w(A(y,"users",t),s)}async delete(t){await Y(A(y,"users",t))}}const T=new oe;function ne({children:a}){const t=U(),[s,c]=i.useState(void 0),[o,r]=i.useState(void 0),u=["/login","/access-not-available"].includes(t.pathname);return i.useEffect(()=>{const v=N.onAuthStateChanged(async n=>{if(c(n??null),n)try{const p=(await T.getById(n.uid))?.status??"active";r(p)}catch(d){console.error("RequireAuth: failed to fetch user document",d),r("active")}else r(void 0)});return()=>v()},[]),u?e.jsx(e.Fragment,{children:a}):s===void 0?e.jsx("div",{children:"Loading..."}):s?o===void 0?e.jsx("div",{children:"Loading..."}):o!=="active"?e.jsx(x,{to:"/access-not-available",replace:!0}):e.jsx(e.Fragment,{children:a}):e.jsx(x,{to:"/login",replace:!0})}function I({children:a,allowedRoles:t,allowedStatuses:s}){const c=U(),[o,r]=i.useState(void 0),[l,u]=i.useState(void 0),[v,n]=i.useState(void 0),p=["/login","/access-not-available"].includes(c.pathname);return i.useEffect(()=>{const R=N.onAuthStateChanged(async g=>{if(u(g??null),g)try{const j=await T.getById(g.uid),b=j?.status??"active",k=j?.role??"user";r(b),n(k),(s??["active"]).includes(b)||console.warn("RequireRole: user status not allowed",b)}catch(j){console.error("RequireRole: failed to fetch user document",j),r("active"),n("user")}else r(void 0),n(void 0)});return()=>R()},[s]),p?e.jsx(e.Fragment,{children:a}):l===void 0?e.jsx("div",{children:"Loading..."}):l?v===void 0||o===void 0?e.jsx("div",{children:"Loading..."}):(s??["active"]).includes(o)?t.includes("everyone")||t.includes(v)?e.jsx(e.Fragment,{children:a}):e.jsx(x,{to:"/access-not-available",replace:!0}):e.jsx(x,{to:"/access-not-available",replace:!0}):e.jsx(x,{to:"/login",replace:!0})}const ie=i.lazy(()=>h(()=>import("./login-0Nx25AUE.js"),__vite__mapDeps([0,1,2,3])));i.lazy(()=>h(()=>import("./home-BViOqBRV.js"),__vite__mapDeps([4,1,2,3,5])));const ae=i.lazy(()=>h(()=>import("./task-DrF2JJ4E.js"),__vite__mapDeps([6,1,2,3,7,5]))),ce=i.lazy(()=>h(()=>import("./users-B4TRmNDu.js"),__vite__mapDeps([8,1,2,3,9]))),le=i.lazy(()=>h(()=>import("./dashboard-BBZhySKQ.js"),__vite__mapDeps([10,1,2,3,5]))),ue=i.lazy(()=>h(()=>import("./accessNotAvailable-DD23_pfr.js"),__vite__mapDeps([11,1,2,3,5]))),de=i.lazy(()=>h(()=>import("./layout-Dh8T5Ih1.js"),__vite__mapDeps([12,1,2,13]))),pe=i.lazy(()=>h(()=>import("./main-layout-YlkRtq_F.js"),__vite__mapDeps([14,1,2,3,15])));z.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(C,{children:e.jsx(i.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsxs(F,{children:[e.jsx(m,{path:"/",element:e.jsx(te,{})}),e.jsxs(m,{element:e.jsx(de,{}),children:[e.jsx(m,{path:"/login",element:e.jsx(ie,{})}),e.jsx(m,{path:"/access-not-available",element:e.jsx(ue,{})})]}),e.jsxs(m,{element:e.jsx(ne,{children:e.jsx(pe,{})}),children:[e.jsx(m,{path:"/dashboard",element:e.jsx(I,{allowedRoles:["user","admin"],children:e.jsx(le,{})})}),e.jsx(m,{path:"/task",element:e.jsx(ae,{})}),e.jsx(m,{path:"/users",element:e.jsx(I,{allowedRoles:["admin"],children:e.jsx(ce,{})})})]})]})})})}));export{N as A,ee as S,T as U,_ as a,y as d};
