const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/login-Dxgeh1AT.js","assets/vendor_react-DAGpP-PG.js","assets/vendor-DuPUYBON.js","assets/vendor_firebase-CZSQ0ZSP.js","assets/home-DUueXu4a.js","assets/App-DEF85R_q.css","assets/task-CQnQyjs7.js","assets/task-Bwuw-X_A.css","assets/users-Uk9TRNhO.js","assets/users-yjea5Z32.css","assets/dashboard-7600iiq7.js","assets/accessNotAvailable-iEEuL6ZY.js","assets/layout-wDGMGWfD.js","assets/layout-724H31W2.css","assets/main-layout-BM1btqfk.js","assets/main-layout-BPKYgo-Z.css"])))=>i.map(i=>d[i]);
import{j as t,L as P,r as a,N as j,c as O,H as U,R as T,a as h}from"./vendor_react-DAGpP-PG.js";import{i as N,g as k,a as q,o as z,G as C,s as V,b as B,c as E,d as F,e as x,f as G,h as M,j as $,u as H,k as J,l as R}from"./vendor_firebase-CZSQ0ZSP.js";import"./vendor-DuPUYBON.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();const K="modulepreload",W=function(l){return"/Taskly-v0.2/"+l},S={},m=function(e,r,i){let s=Promise.resolve();if(r&&r.length>0){let v=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");s=v(r.map(d=>{if(d=W(d),d in S)return;S[d]=!0;const p=d.endsWith(".css"),f=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${f}`))return;const u=document.createElement("link");if(u.rel=p?"stylesheet":K,p||(u.as="script"),u.crossOrigin="",u.href=d,c&&u.setAttribute("nonce",c),document.head.appendChild(u),p)return new Promise((g,A)=>{u.addEventListener("load",g),u.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return s.then(o=>{for(const c of o||[])c.status==="rejected"&&n(c.reason);return e().catch(n)})};function X({id:l,children:e}){return t.jsx("section",{id:l,className:"section center",children:e})}function Y(){return t.jsxs(X,{children:[t.jsx("h1",{children:"Taskly"}),t.jsx(P,{to:"/login",children:"Get Started"})]})}const Z={apiKey:"AIzaSyDbeHsZ1hrXAnCRePrfJFqkSDelKOGtqJU",authDomain:"taskly-2542f.firebaseapp.com",projectId:"taskly-2542f",storageBucket:"taskly-2542f.firebasestorage.app",messagingSenderId:"141937666380",appId:"1:141937666380:web:8a8aa08b12e2e4490887e9",measurementId:"G-MY6GLXVEPJ"},w=N(Z),_=k(w),y=q(w);class Q{onAuthStateChanged(e){return z(_,e)}async signInWithGoogle(){const e=new C;return await V(_,e)}async signOutUser(){await B(_)}getCurrentUser(){return _.currentUser}}const I=new Q;function L(l,e){return{id:l,uid:e.uid??e.authUid??void 0,displayName:e.displayName??e.name,email:e.email,photoURL:e.photoURL,role:e.role??"user",department:e.department,status:e.status,lastActive:e.lastActive,createdAt:e.createdAt?.seconds?e.createdAt.seconds*1e3:e.createdAt??Date.now()}}class ee{constructor(){this.col=E(y,"users")}async getAll(){return(await F(this.col)).docs.map(r=>L(r.id,r.data()))}async getById(e){const r=x(y,"users",e),i=await G(r);return i.exists()?L(i.id,i.data()):null}async create(e){return(await M(E(y,"users"),{...e,createdAt:e.createdAt??Date.now()})).id}async upsertByUid(e,r){const i=x(y,"users",e);await $(i,{...r,uid:e,updatedAt:R(),createdAt:R()},{merge:!0})}async update(e,r){await H(x(y,"users",e),r)}async delete(e){await J(x(y,"users",e))}}const D=new ee;function te({children:l}){const[e,r]=a.useState(void 0),[i,s]=a.useState(void 0);return a.useEffect(()=>{const n=I.onAuthStateChanged(async o=>{if(r(o??null),o)try{const v=(await D.getById(o.uid))?.status??"active";s(v)}catch(c){console.error("RequireAuth: failed to fetch user document",c),s("active")}else s(void 0)});return()=>n()},[]),e===void 0?t.jsx("div",{children:"Loading..."}):e?i===void 0?t.jsx("div",{children:"Loading..."}):i!=="active"?t.jsx(j,{to:"/access-not-available",replace:!0}):t.jsx(t.Fragment,{children:l}):t.jsx(j,{to:"/login",replace:!0})}function b({children:l,allowedRoles:e,allowedStatuses:r}){const[i,s]=a.useState(void 0),[n,o]=a.useState(void 0),[c,v]=a.useState(void 0);return a.useEffect(()=>{const p=I.onAuthStateChanged(async f=>{if(o(f??null),f)try{const u=await D.getById(f.uid),g=u?.status??"active",A=u?.role??"user";s(g),v(A),(r??["active"]).includes(g)||console.warn("RequireRole: user status not allowed",g)}catch(u){console.error("RequireRole: failed to fetch user document",u),s("active"),v("user")}else s(void 0),v(void 0)});return()=>p()},[r]),n===void 0?t.jsx("div",{children:"Loading..."}):n?c===void 0||i===void 0?t.jsx("div",{children:"Loading..."}):(r??["active"]).includes(i)?e.includes("everyone")||e.includes(c)?t.jsx(t.Fragment,{children:l}):t.jsx(j,{to:"/access-not-available",replace:!0}):t.jsx(j,{to:"/access-not-available",replace:!0}):t.jsx(j,{to:"/login",replace:!0})}const se=a.lazy(()=>m(()=>import("./login-Dxgeh1AT.js"),__vite__mapDeps([0,1,2,3])));a.lazy(()=>m(()=>import("./home-DUueXu4a.js"),__vite__mapDeps([4,1,2,3,5])));const re=a.lazy(()=>m(()=>import("./task-CQnQyjs7.js"),__vite__mapDeps([6,1,2,3,7,5]))),ne=a.lazy(()=>m(()=>import("./users-Uk9TRNhO.js"),__vite__mapDeps([8,1,2,3,9]))),oe=a.lazy(()=>m(()=>import("./dashboard-7600iiq7.js"),__vite__mapDeps([10,1,2,3,5]))),ae=a.lazy(()=>m(()=>import("./accessNotAvailable-iEEuL6ZY.js"),__vite__mapDeps([11,1,2,3,5]))),ie=a.lazy(()=>m(()=>import("./layout-wDGMGWfD.js"),__vite__mapDeps([12,1,2,13]))),ce=a.lazy(()=>m(()=>import("./main-layout-BM1btqfk.js"),__vite__mapDeps([14,1,2,3,15])));O.createRoot(document.getElementById("root")).render(t.jsx(a.StrictMode,{children:t.jsx(U,{children:t.jsx(a.Suspense,{fallback:t.jsx("div",{children:"Loading..."}),children:t.jsxs(T,{children:[t.jsx(h,{path:"/",element:t.jsx(Y,{})}),t.jsxs(h,{element:t.jsx(ie,{}),children:[t.jsx(h,{path:"/login",element:t.jsx(se,{})}),t.jsx(h,{path:"/access-not-available",element:t.jsx(ae,{})})]}),t.jsxs(h,{element:t.jsx(te,{children:t.jsx(ce,{})}),children:[t.jsx(h,{path:"/dashboard",element:t.jsx(b,{allowedRoles:["user","admin"],children:t.jsx(oe,{})})}),t.jsx(h,{path:"/task",element:t.jsx(re,{})}),t.jsx(h,{path:"/users",element:t.jsx(b,{allowedRoles:["admin"],children:t.jsx(ne,{})})})]})]})})})}));export{I as A,X as S,D as U,_ as a,y as d};
