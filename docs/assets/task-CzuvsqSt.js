import{r as l,j as e,S as Ne,F as ve,P as O,C as te,b as ae,d as be,e as we,f as ie,g as ne,E as oe,h as le,T as re,i as Se,k as _e,l as Te,m as Ce,n as De}from"./vendor_react-DpDlS_K3.js";/* empty css            */import{d as k,S as ze}from"./index-BIn2iJ_I.js";import{c as Ee,d as U,q as Ie,w as Pe,e as T,f as Fe,T as f,h as Me,u as de,j as Ae}from"./vendor_firebase-CsWAWMrr.js";import"./vendor-DuPUYBON.js";class Re{constructor(){this.ref=Ee(k,"tasks")}async getAllTasks(){return(await U(this.ref)).docs.map(i=>({id:i.id,...i.data()}))}async getMainTasks(){return(await U(this.ref)).docs.map(i=>({id:i.id,...i.data()})).filter(i=>i.parent_id===null||i.parent_id===void 0)}async getSubTasks(a){const i=Ie(this.ref,Pe("parent_id","==",a));return(await U(i)).docs.map(p=>({id:p.id,...p.data()}))}async getTaskById(a){const i=T(k,"tasks",a),d=await Fe(i);return d.exists()?{id:d.id,...d.data()}:null}async createTask(a){if(a.priority<1||a.priority>4)throw new Error("Priority must be between 1 and 4");const i=f.now();await Me(this.ref,{task_name:a.task_name,description:a.description??null,parent_id:a.parent_id??null,status:a.status??"todo",priority:a.priority,due_date:a.due_date?f.fromDate(a.due_date):null,created_at:i,updated_at:i,completed_at:a.status==="done"?i:null})}async updateStatus(a,i){if(!["todo","in_progress","blocked","done"].includes(i))throw new Error("Invalid status value");const d=f.now(),p=T(k,"tasks",a);await de(p,{status:i,updated_at:d,completed_at:i==="done"?d:null})}async updateTask(a,i){const d=f.now(),p=T(k,"tasks",a),m={...i,updated_at:d};i.due_date&&(m.due_date=f.fromDate(i.due_date)),Object.keys(m).forEach(y=>{m[y]===void 0&&delete m[y]}),await de(p,m)}async deleteTask(a){await Ae(T(k,"tasks",a))}}class Le{constructor(a){this.taskRepository=a}async completeTask(a){await this.taskRepository.updateStatus(a,"done")}async reopenTask(a){await this.taskRepository.updateStatus(a,"todo")}async updateStatus(a,i){await this.taskRepository.updateStatus(a,i)}async deleteTask(a){await this.taskRepository.deleteTask(a)}}const j=new Re,qe=new Le(j);function He(){const[C,a]=l.useState([]),[i,d]=l.useState({}),[p,m]=l.useState(!0),[y,D]=l.useState(!1),[ce,W]=l.useState(!1),[u,g]=l.useState(!1),[V,N]=l.useState(null),[z,ue]=l.useState("all"),[E,pe]=l.useState(""),[me,xe]=l.useState(new Set),[v,$]=l.useState(null),[b,I]=l.useState(null),[r,P]=l.useState({task_name:"",description:"",priority:3,status:"todo",due_date:""}),[he,w]=l.useState(!1),[F,S]=l.useState([]),[Be,Oe]=l.useState(!1);l.useEffect(()=>{M()},[]);async function M(){try{m(!0),console.log("Loading tasks from Firestore...");const s=await j.getMainTasks();console.log("Main tasks loaded:",s),a(s);const t={};for(const n of s)if(n.id){const c=await j.getSubTasks(n.id);t[n.id]=c}d(t)}catch(s){console.error("Error loading tasks:",s),alert("Error loading tasks: "+s.message)}finally{m(!1)}}async function Q(s){try{await qe.deleteTask(s),await M()}catch(t){console.error("Error deleting task:",t),alert("Error deleting task: "+t.message)}}function A(s){P({task_name:"",description:"",priority:3,status:"todo",due_date:""}),w(!1),I(null),S([]),s?(g(!0),N(s)):(g(!1),N(null)),D(!0)}function _(){D(!1),w(!1),g(!1),N(null),I(null),S([])}function G(s){P({task_name:s.task_name||"",description:s.description||"",priority:s.priority||2,status:s.status||"todo",due_date:s.due_date?s.due_date.seconds?new Date(s.due_date.seconds*1e3).toISOString().slice(0,10):new Date(s.due_date).toISOString().slice(0,10):""}),I(s.id||null),g(s.parent_id!==null&&s.parent_id!==void 0),N(s.parent_id??null),D(!0)}function R(){W(!1)}function h(s){const{name:t,value:n}=s.target;P(c=>({...c,[t]:n}))}function ke(s){const t=s.target.files;if(t){const n=Array.from(t);S(c=>[...c,...n])}}function fe(s){S(t=>t.filter((n,c)=>c!==s))}function je(s){xe(t=>{const n=new Set(t);return n.has(s)?n.delete(s):n.add(s),n})}function H(s){$(t=>t===s?null:s)}function x(){$(null)}l.useEffect(()=>{function s(){x()}return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);function X(){let s=C;if(z!=="all"&&(s=s.filter(t=>{switch(z){case"todo":return t.status==="todo";case"in_progress":return t.status==="in_progress";case"done":return t.status==="done";default:return!0}})),E.trim()){const t=E.toLowerCase();s=s.filter(n=>n.task_name.toLowerCase().includes(t)||n.description&&n.description.toLowerCase().includes(t))}return s}function J(s){switch(s){case"todo":return{icon:ae,color:"text-slate-400"};case"in_progress":return{icon:te,color:"text-blue-500"};case"done":return{icon:De,color:"text-emerald-500"};default:return{icon:Ce,color:"text-red-500"}}}function K(s){switch(s){case 1:return{color:"text-slate-400",text:"P4"};case 2:return{color:"text-blue-500",text:"P3"};case 3:return{color:"text-orange-500",text:"P2"};case 4:return{color:"text-red-500",text:"P1"};default:return{color:"text-slate-400",text:"P4"}}}function Y(s){if(!s)return"No date";const t=s;return(t.seconds?new Date(t.seconds*1e3):new Date(s)).toLocaleDateString("en-US",{month:"short",day:"numeric"})}async function Z(s){if(s&&s.preventDefault&&s.preventDefault(),w(!0),!(!r.task_name||r.task_name.trim()===""))try{const t={task_name:r.task_name.trim(),description:r.description.trim()||void 0,status:r.status,priority:Number(r.priority),due_date:r.due_date?new Date(r.due_date):void 0,parent_id:u&&V?V:void 0};console.log("Submitting task:",t),b?(await j.updateTask(b,t),console.log("Task updated successfully!")):(await j.createTask(t),console.log("Task created successfully!")),await M(),console.log("Tasks reloaded"),w(!1),_(),W(!0)}catch(t){console.error("Error adding task from modal:",t),alert("Failed to add task: "+t.message+`

Check console for details.`)}}return e.jsxs(ze,{id:"task",children:[e.jsxs("div",{className:"task-header-section",children:[e.jsxs("div",{className:"header-content",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"header-title",children:"Tasks"}),e.jsx("p",{className:"header-subtitle",children:"Manage your tasks effectively with Taskly"})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{className:"search-container",children:[e.jsx(Ne,{className:"search-icon",size:20}),e.jsx("input",{type:"text",placeholder:"Search tasks...",className:"search-input",value:E,onChange:s=>pe(s.target.value)})]}),e.jsx("button",{className:"filter-button",children:e.jsx(ve,{size:20})}),e.jsxs("button",{className:"new-task-button",onClick:()=>A(),children:[e.jsx(O,{size:20}),"New Task"]})]})]}),e.jsx("div",{className:"filter-tabs",children:[{key:"all",label:"All Tasks"},{key:"todo",label:"To Do"},{key:"in_progress",label:"In Progress"},{key:"done",label:"Done"}].map(s=>e.jsx("button",{className:`filter-tab ${z===s.key?"active":""}`,onClick:()=>ue(s.key),children:s.label},s.key))})]}),e.jsx("div",{className:"task-list-container",children:p?e.jsxs("div",{className:"loading-state",children:[e.jsx(te,{className:"animate-spin",size:24}),e.jsx("p",{children:"Loading tasks..."})]}):X().length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(ae,{size:48,className:"text-slate-300"}),e.jsx("h3",{children:"No tasks found"}),e.jsx("p",{children:"Get started by creating your first task!"}),e.jsxs("button",{className:"empty-state-button",onClick:()=>A(),children:[e.jsx(O,{size:20}),"Create Task"]})]}):e.jsx("div",{className:"tasks-list",children:X().map(s=>{const t=s.id?i[s.id]||[]:[],n=t.length>0,c=s.id?me.has(s.id):!1,ee=J(s.status),L=K(s.priority),ye=ee.icon;return e.jsxs("div",{className:"task-row-container",children:[e.jsxs("div",{className:"task-row",children:[e.jsx("button",{className:"expand-button",onClick:()=>s.id&&n&&je(s.id),disabled:!n,children:n?c?e.jsx(be,{size:16,className:"text-slate-500"}):e.jsx(we,{size:16,className:"text-slate-500"}):e.jsx("div",{className:"w-4 h-4"})}),e.jsxs("div",{className:"task-content",children:[e.jsx("div",{className:"task-title-row",children:e.jsx("h3",{className:"task-title",children:s.task_name})}),s.description&&e.jsx("p",{className:"task-description",children:s.description})]}),e.jsxs("div",{className:"status-badge",children:[e.jsx(ye,{size:16,className:ee.color}),e.jsx("span",{className:"status-text",children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"priority-badge",children:[e.jsx(ie,{size:16,className:L.color}),e.jsx("span",{className:`priority-text ${L.color}`,children:L.text})]}),e.jsxs("div",{className:"due-date",children:[e.jsx(ne,{size:16,className:"text-slate-500"}),e.jsx("span",{className:"due-date-text",children:Y(s.due_date)})]}),e.jsx("div",{className:"task-actions-dropdown",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{className:"more-actions-button",onClick:o=>{o.stopPropagation(),s.id&&H(s.id)},"aria-expanded":v===s.id,children:e.jsx(oe,{size:16,className:"text-slate-500"})}),v===s.id&&e.jsxs("div",{className:"dropdown-menu",onClick:o=>o.stopPropagation(),children:[(s.parent_id===null||s.parent_id===void 0)&&e.jsxs("div",{className:"dropdown-item",onClick:()=>{x(),s.id&&A(s.id)},children:[e.jsx(O,{size:14}),e.jsx("span",{children:"Add Subtask"})]}),e.jsxs("div",{className:"dropdown-item",onClick:()=>{x(),G(s)},children:[e.jsx(le,{size:14}),e.jsx("span",{children:"Edit Task"})]}),e.jsxs("div",{className:"dropdown-item delete",onClick:()=>{x(),s.id&&Q(s.id)},children:[e.jsx(re,{size:14}),e.jsx("span",{children:"Delete Task"})]})]})]})})]}),n&&c&&e.jsxs("div",{className:"subtasks-container",children:[e.jsx("div",{className:"connector-line"}),t.map((o,Ue)=>{const se=J(o.status),q=K(o.priority),ge=se.icon;return e.jsxs("div",{className:"subtask-row",children:[e.jsx("div",{className:"horizontal-connector"}),e.jsxs("div",{className:"subtask-card",children:[e.jsx("div",{className:"expand-button-placeholder"}),e.jsxs("div",{className:"task-content",children:[e.jsx("div",{className:"task-title-row",children:e.jsx("h4",{className:"subtask-title",children:o.task_name})}),o.description&&e.jsx("p",{className:"task-description",children:o.description})]}),e.jsxs("div",{className:"status-badge",children:[e.jsx(ge,{size:16,className:se.color}),e.jsx("span",{className:"status-text",children:o.status.replace("_"," ")})]}),e.jsxs("div",{className:"priority-badge",children:[e.jsx(ie,{size:16,className:q.color}),e.jsx("span",{className:`priority-text ${q.color}`,children:q.text})]}),e.jsxs("div",{className:"due-date",children:[e.jsx(ne,{size:16,className:"text-slate-500"}),e.jsx("span",{className:"due-date-text",children:Y(o.due_date)})]}),e.jsx("div",{className:"task-actions-dropdown",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{className:"more-actions-button",onClick:B=>{B.stopPropagation(),o.id&&H(o.id)},"aria-expanded":v===o.id,children:e.jsx(oe,{size:16,className:"text-slate-500"})}),v===o.id&&e.jsxs("div",{className:"dropdown-menu",onClick:B=>B.stopPropagation(),children:[e.jsxs("div",{className:"dropdown-item",onClick:()=>{x(),G(o)},children:[e.jsx(le,{size:14}),e.jsx("span",{children:"Edit Task"})]}),e.jsxs("div",{className:"dropdown-item delete",onClick:()=>{x(),o.id&&Q(o.id)},children:[e.jsx(re,{size:14}),e.jsx("span",{children:"Delete Task"})]})]})]})})]})]},o.id)})]})]},s.id)})})}),y&&e.jsx("div",{className:"task-modal-overlay",onClick:_,children:e.jsxs("div",{className:"task-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"task-modal-header",children:[e.jsx("h2",{className:"task-modal-title",children:b?u?"Edit Subtask":"Edit Task":u?"Add New Subtask":"Add New Task"}),e.jsx("button",{className:"task-modal-close-btn",type:"button",onClick:_,"aria-label":"Close modal",children:"×"})]}),e.jsx("div",{className:"task-modal-body",children:e.jsxs("form",{id:"taskForm",onSubmit:Z,children:[e.jsxs("div",{className:"task-form-group",children:[e.jsxs("label",{className:"task-form-label",children:[u?"Subtask Name":"Task Name",e.jsx("span",{style:{color:"#dc2626"},children:"*"})]}),e.jsx("input",{type:"text",className:"task-input-field",name:"task_name",id:"taskName",placeholder:u?"Enter subtask name":"Enter task name",value:r.task_name,onChange:h,required:!0}),e.jsx("div",{className:"task-error-message",id:"taskNameError",style:{display:he&&!r.task_name?"block":"none"},children:u?"Subtask name is required":"Task name is required"})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Description"}),e.jsx("textarea",{className:"task-input-field",id:"taskDescription",name:"description",placeholder:"Add a description (optional)",value:r.description,onChange:h})]}),e.jsxs("div",{className:"task-form-row",children:[e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Status"}),e.jsxs("select",{className:"task-input-field",id:"taskStatus",name:"status",value:r.status,onChange:h,children:[e.jsx("option",{value:"todo",children:"Todo"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"done",children:"Done"})]})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsxs("label",{className:"task-form-label task-priority-label-header",children:["Priority",e.jsx("span",{className:"task-info-icon",children:"i"})]}),e.jsxs("select",{className:"task-input-field",id:"taskPriority",name:"priority",value:r.priority,onChange:h,children:[e.jsx("option",{value:1,children:"Low"}),e.jsx("option",{value:2,children:"Medium"}),e.jsx("option",{value:3,children:"High"}),e.jsx("option",{value:4,children:"Urgent"})]})]})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Due Date"}),e.jsx("input",{type:"date",className:"task-input-field",id:"taskDueDate",name:"due_date",value:r.due_date,onChange:h})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Attachments"}),e.jsxs("div",{style:{border:"2px dashed #cbd5e1",borderRadius:"8px",padding:"16px",textAlign:"center",cursor:"pointer",transition:"all 0.3s ease",backgroundColor:"#f8fafc"},children:[e.jsx("input",{type:"file",multiple:!0,onChange:ke,style:{display:"none"},id:"fileInput",accept:"image/*,.pdf,.doc,.docx,.txt"}),e.jsxs("label",{htmlFor:"fileInput",style:{cursor:"pointer",display:"block"},children:[e.jsx(Se,{size:24,style:{margin:"0 auto 8px",color:"#7c3aed"}}),e.jsx("p",{style:{margin:"8px 0 4px",color:"#334155",fontWeight:"500"},children:"Click to upload or drag files"}),e.jsx("p",{style:{margin:"0",color:"#94a3b8",fontSize:"0.875rem"},children:"Images, PDF, DOC, TXT (Max 10MB each)"})]})]}),F.length>0&&e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsxs("p",{style:{fontSize:"0.875rem",color:"#475569",marginBottom:"8px"},children:["Selected files: ",F.length]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:F.map((s,t)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",backgroundColor:"#f1f5f9",borderRadius:"6px",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",minWidth:"0"},children:[e.jsx(_e,{size:18,style:{color:"#7c3aed",flexShrink:0}}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#334155",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s.name})]}),e.jsx("button",{type:"button",onClick:()=>fe(t),style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#ef4444",display:"flex",alignItems:"center",flexShrink:0},title:"Remove file",children:e.jsx(Te,{size:16})})]},t))})]})]})]})}),e.jsxs("div",{className:"task-modal-footer",children:[e.jsx("button",{type:"button",className:"task-btn task-btn-cancel",onClick:_,children:"Cancel"}),e.jsx("button",{type:"button",className:"task-btn task-btn-primary",onClick:Z,children:b?u?"Save Subtask":"Save Task":u?"Add Subtask":"Add Task"})]})]})}),ce&&e.jsx("div",{className:"task-modal-overlay",onClick:R,children:e.jsxs("div",{className:"task-modal",onClick:s=>s.stopPropagation(),style:{maxWidth:"400px",textAlign:"center"},children:[e.jsx("div",{className:"task-modal-header",style:{borderBottom:"none",justifyContent:"flex-end",padding:"12px 16px"},children:e.jsx("button",{className:"task-modal-close-btn",type:"button",onClick:R,"aria-label":"Close modal",children:"×"})}),e.jsxs("div",{className:"task-modal-body",style:{padding:"20px 32px 32px"},children:[e.jsx("div",{style:{width:"80px",height:"80px",margin:"0 auto 24px",borderRadius:"50%",background:"linear-gradient(135deg, rgba(124,58,237,0.1), rgba(124,58,237,0.05))",display:"flex",alignItems:"center",justifyContent:"center",border:"3px solid #7c3aed"},children:e.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"#7c3aed",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("h2",{style:{fontSize:"1.5rem",color:"#0f172a",marginBottom:"12px",fontWeight:"600"},children:"Awesome!"}),e.jsxs("p",{style:{color:"#64748b",fontSize:"0.95rem",marginBottom:"28px"},children:[u?"Subtask":"Task"," successfully added to your list"]}),e.jsx("button",{type:"button",className:"task-btn task-btn-primary",onClick:R,style:{width:"100%",padding:"12px",fontSize:"1rem"},children:"Continue"})]})]})})]})}export{He as default};
