import{u as j,r as n,j as e,L as f,O as N}from"./vendor_react-ByBjJ8Oe.js";import{A as g}from"./index-Bqv5hdDK.js";import{U}from"./UsersRepository-DM2zLpsg.js";import"./vendor-DuPUYBON.js";import"./vendor_firebase-i8bcTDRB.js";const k=[{sortOrder:1,name:"Dashboard",icon:"",link:"/dashboard"},{sortOrder:8,name:"Tasks",icon:"",link:"/task"},{sortOrder:16,name:"Calendar",icon:"",link:"/calendar"},{sortOrder:24,name:"Users",icon:"",link:"/users"},{sortOrder:32,name:"Settings",icon:"",link:"/settings"},{sortOrder:99,name:"Logout",icon:"",action:"logout"}];function L({photoURL:i,name:c,size:o=80,bgColor:t="#667eea"}={}){return i||`https://ui-avatars.com/api/?name=${encodeURIComponent(c||"User")}&background=${t.replace("#","")}&color=fff&size=${o}`}function S({children:i}){const c=j(),[o,t]=n.useState(!1),[u,h]=n.useState(null),[O,m]=n.useState(null),[b,l]=n.useState(null);n.useEffect(()=>{const a=g.onAuthStateChanged(async s=>{if(s){h(s.displayName||s.email||"User"),m(s.email||"");try{const r=await U.getById(s.uid);if(console.log("Sidebar auth user:",s),console.log("Sidebar providerData:",s.providerData),console.log("Sidebar userDoc from Firestore:",r),r&&r.photoURL)l(r.photoURL);else{const d=s.providerData&&s.providerData.length>0?s.providerData[0].photoURL:void 0;l(s.photoURL??d??null)}}catch(r){console.error("Failed to fetch user document:",r);const d=s.providerData&&s.providerData.length>0?s.providerData[0].photoURL:void 0;l(s.photoURL??d??null)}}else h(null),m(null),l(null)});return()=>a()},[]);const x=async()=>{try{await g.signOutUser(),c("/login")}catch(a){console.error("Logout failed:",a)}},v=()=>{t(!o)},p=()=>{t(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`hamburger-btn ${o?"hamburger-open":""}`,onClick:v,"aria-expanded":o,"aria-label":o?"Close sidebar":"Open sidebar",children:e.jsx("i",{className:"bi bi-list"})}),o&&e.jsx("div",{className:"sidebar-overlay",onClick:p}),e.jsxs("aside",{className:`sidebar ${o?"sidebar-open":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h2",{children:"Tasky"}),e.jsxs("div",{className:"user-profile",children:[e.jsx("div",{className:"user-avatar",children:e.jsx("img",{id:"userPhoto",src:L({photoURL:b,name:u||"User",size:80,bgColor:"#3498db"}),alt:"Profile"})}),e.jsx("div",{className:"user-info",children:e.jsx("h5",{id:"userName",children:u??"Loading..."})})]})]}),e.jsx("ul",{children:k.map(a=>e.jsx("li",{children:a.link?e.jsxs(f,{to:a.link,onClick:p,children:[a.icon&&e.jsx("span",{className:"material-icons",children:a.icon}),a.name]}):a.action==="logout"?e.jsxs("button",{onClick:x,className:"logout-btn",children:[a.icon&&e.jsx("span",{className:"material-icons",children:a.icon}),a.name]}):null},a.link||a.action))}),i]})]})}function E(){return e.jsxs("div",{className:"main-layout-container",children:[e.jsx(S,{}),e.jsx("main",{className:"main-content",children:e.jsx(N,{})})]})}export{E as default};
