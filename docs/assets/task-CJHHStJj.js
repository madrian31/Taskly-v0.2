import{j as e,F as qe,b as xe,D as fe,T as ge,r as h,S as Oe,d as Ve,P as O,C as je,e as ke,f as Ge,g as We,h as Ne,i as we,E as ve,k as ee,l as se,m as Qe,n as He}from"./vendor_react-CpPT884W.js";/* empty css            */import{d as z,a as ye,S as Xe}from"./index-CeFBknfc.js";import{c as Je,q as te,w as D,d as ae,e as V,f as G,T as $,h as Ke,u as be,k as Ye,m as Ze,r as Se,n as es,p as ss,t as ts}from"./vendor_firebase-CZSQ0ZSP.js";import"./vendor-DuPUYBON.js";function as({isOpen:j,showSuccess:t,onClose:a,onCloseSuccess:i,onSubmit:n,form:o,handleFormChange:u,handleFileSelect:p,removeFile:k,removeAttachment:y,isImageAttachment:S,uploadedFiles:x,attachments:w,uploading:f,editingTaskId:b,isSubtaskMode:N,showValidationErrors:C,fileUploadService:T}){return!j&&!t?null:e.jsxs(e.Fragment,{children:[j&&e.jsx("div",{className:"task-modal-overlay",onClick:a,children:e.jsxs("div",{className:"task-modal",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"task-modal-header",children:[e.jsx("h2",{className:"task-modal-title",children:b?N?"Edit Subtask":"Edit Task":N?"Add New Subtask":"Add New Task"}),e.jsx("button",{className:"task-modal-close-btn",type:"button",onClick:a,"aria-label":"Close modal",children:"×"})]}),e.jsx("div",{className:"task-modal-body",children:e.jsxs("form",{id:"taskForm",onSubmit:n,children:[e.jsxs("div",{className:"task-form-group",children:[e.jsxs("label",{className:"task-form-label",children:[N?"Subtask Name":"Task Name",e.jsx("span",{className:"required-star",children:"*"})]}),e.jsx("input",{type:"text",className:"task-input-field",name:"task_name",id:"taskName",placeholder:N?"Enter subtask name":"Enter task name",value:o.task_name,onChange:u,required:!0}),e.jsx("div",{className:`task-error-message ${C&&!o.task_name?"task-error-visible":""}`,id:"taskNameError",children:N?"Subtask name is required":"Task name is required"})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Description"}),e.jsx("textarea",{className:"task-input-field",id:"taskDescription",name:"description",placeholder:"Add a description (optional)",value:o.description,onChange:u})]}),e.jsxs("div",{className:"task-form-row",children:[e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Status"}),e.jsxs("select",{className:"task-input-field",id:"taskStatus",name:"status",value:o.status,onChange:u,children:[e.jsx("option",{value:"todo",children:"Todo"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"done",children:"Done"})]})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsxs("label",{className:"task-form-label task-priority-label-header",children:["Priority",e.jsx("span",{className:"task-info-icon",children:"i"})]}),e.jsxs("select",{className:"task-input-field",id:"taskPriority",name:"priority",value:o.priority,onChange:u,children:[e.jsx("option",{value:1,children:"Low"}),e.jsx("option",{value:2,children:"Medium"}),e.jsx("option",{value:3,children:"High"}),e.jsx("option",{value:4,children:"Urgent"})]})]})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Due Date"}),e.jsx("input",{type:"date",className:"task-input-field",id:"taskDueDate",name:"due_date",value:o.due_date,onChange:u})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Attachments"}),e.jsxs("div",{className:`file-upload-box ${f?"uploading":""}`,children:[e.jsx("input",{type:"file",multiple:!0,onChange:p,className:"file-input-hidden",id:"fileInput",accept:"image/*,.pdf,.doc,.docx,.txt",disabled:f}),e.jsxs("label",{htmlFor:"fileInput",className:`file-upload-label ${f?"uploading":""}`,children:[e.jsx(qe,{size:24,className:"fileup-icon"}),e.jsx("p",{className:"file-upload-title",children:"Click to upload or drag files"}),e.jsx("p",{className:"file-upload-note",children:"Images, PDF, DOC, TXT (Max 10MB each)"})]})]}),w.length>0&&e.jsxs("div",{className:"attachments-section",children:[e.jsxs("p",{className:"attachments-heading",children:["Current Attachments: ",w.length]}),w.some(r=>S(r))&&e.jsxs("div",{className:"images-grid",children:[e.jsx("p",{className:"images-heading-small",children:"Images:"}),e.jsx("div",{className:"images-grid-grid",children:w.filter(r=>S(r)).map(r=>e.jsxs("div",{className:"attachment-item",children:[e.jsx("img",{src:r.fileUrl,alt:r.fileName,className:"attachment-img"}),e.jsx("button",{type:"button",onClick:()=>y(r.id),className:"attachment-remove-btn",title:`Remove ${r.fileName}`,children:"×"})]},r.id))})]}),w.some(r=>!S(r))&&e.jsxs("div",{children:[e.jsx("p",{className:"attachment-files-heading",children:"Files:"}),e.jsx("div",{className:"attachment-files-list",children:w.filter(r=>!S(r)).map(r=>e.jsxs("div",{className:"attachment-file-row",children:[e.jsxs("div",{className:"attachment-file-meta",children:[e.jsx(xe,{size:18,className:"file-icon-purple"}),e.jsx("span",{className:"attachment-file-name",children:r.fileName})]}),e.jsxs("div",{className:"flex-gap-4",children:[e.jsx("a",{href:r.fileUrl,target:"_blank",rel:"noopener noreferrer",title:"Download file",children:e.jsx(fe,{size:16})}),e.jsx("button",{type:"button",onClick:()=>y(r.id),title:"Remove file",className:"icon-button-danger",children:e.jsx(ge,{size:16})})]})]},r.id))})]})]}),x.length>0&&e.jsxs("div",{className:"new-files-section",children:[e.jsxs("p",{className:"new-files-heading",children:["New Files to Upload: ",x.length]}),x.some(r=>T.isImageFile(r))&&e.jsxs("div",{className:"images-grid-wrapper",children:[e.jsx("p",{className:"attachment-files-heading",children:"Images:"}),e.jsx("div",{className:"images-grid-grid",children:x.filter(r=>T.isImageFile(r)).map((r,_)=>e.jsxs("div",{className:"attachment-item",children:[e.jsx("img",{src:URL.createObjectURL(r),alt:r.name,className:"attachment-img",title:r.name}),e.jsx("button",{type:"button",onClick:()=>k(x.indexOf(r)),className:"attachment-remove-btn",title:`Remove ${r.name}`,children:"×"})]},_))})]}),x.some(r=>!T.isImageFile(r))&&e.jsxs("div",{children:[e.jsx("p",{className:"attachment-files-heading",children:"Files:"}),e.jsx("div",{className:"attachment-files-list",children:x.filter(r=>!T.isImageFile(r)).map((r,_)=>e.jsxs("div",{className:"attachment-file-row",children:[e.jsxs("div",{className:"attachment-file-meta",children:[e.jsx(xe,{size:18,className:"file-icon-purple"}),e.jsx("span",{className:"attachment-file-name",children:r.name})]}),e.jsxs("div",{className:"flex-gap-4",children:[e.jsx("a",{href:URL.createObjectURL(r),download:r.name,title:"Download file",children:e.jsx(fe,{size:16})}),e.jsx("button",{type:"button",onClick:()=>k(_),title:"Remove file",className:"icon-button-danger",children:e.jsx(ge,{size:16})})]})]},_))})]})]})]})]})}),e.jsxs("div",{className:"task-modal-footer",children:[e.jsx("button",{type:"button",className:"task-btn task-btn-cancel",onClick:a,disabled:f,children:"Cancel"}),e.jsx("button",{type:"button",className:"task-btn task-btn-primary",onClick:n,disabled:f,children:f?"Uploading...":b?N?"Save Subtask":"Save Task":N?"Add Subtask":"Add Task"})]})]})}),t&&e.jsx("div",{className:"task-modal-overlay",onClick:i,children:e.jsxs("div",{className:"task-modal task-modal--small",onClick:r=>r.stopPropagation(),children:[e.jsx("div",{className:"task-modal-header task-modal-header--compact",children:e.jsx("button",{className:"task-modal-close-btn",type:"button",onClick:i,"aria-label":"Close modal",children:"×"})}),e.jsxs("div",{className:"task-modal-body task-modal-body--success",children:[e.jsx("div",{className:"success-icon-circle",children:e.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"#7c3aed",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("h2",{className:"success-title",children:"Awesome!"}),e.jsxs("p",{className:"success-message",children:[N?"Subtask":"Task"," successfully added to your list"]}),e.jsx("button",{type:"button",className:"task-btn task-btn-primary task-btn-full",onClick:i,children:"Continue"})]})]})})]})}class is{constructor(){this.ref=Je(z,"tasks")}getCurrentUid(){return ye.currentUser?ye.currentUser.uid:null}async getAllTasks(){const t=this.getCurrentUid();if(!t)return[];const a=te(this.ref,D("owner_uid","==",t));return(await ae(a)).docs.map(n=>({id:n.id,...n.data()}))}async getMainTasks(){const t=this.getCurrentUid();if(!t)return[];const a=te(this.ref,D("owner_uid","==",t),D("parent_id","==",null));return(await ae(a)).docs.map(o=>({id:o.id,...o.data()}))}async getSubTasks(t){const a=this.getCurrentUid();if(!a)return[];const i=te(this.ref,D("owner_uid","==",a),D("parent_id","==",t));return(await ae(i)).docs.map(o=>({id:o.id,...o.data()}))}async getTaskById(t){const a=V(z,"tasks",t),i=await G(a);if(!i.exists())return null;const n=i.data(),o=this.getCurrentUid();return!o||n.owner_uid&&n.owner_uid!==o?null:{id:i.id,...n}}async createTask(t){if(t.priority<1||t.priority>4)throw new Error("Priority must be between 1 and 4");const a=$.now(),i=this.getCurrentUid();if(!i)throw new Error("Not authenticated");await Ke(this.ref,{task_name:t.task_name,description:t.description??null,parent_id:t.parent_id??null,status:t.status??"todo",priority:t.priority,due_date:t.due_date?$.fromDate(t.due_date):null,attachments:t.attachments??null,created_at:a,updated_at:a,completed_at:t.status==="done"?a:null,owner_uid:i})}async updateStatus(t,a){if(!["todo","in_progress","blocked","done"].includes(a))throw new Error("Invalid status value");const i=$.now(),n=V(z,"tasks",t),o=await G(n),u=this.getCurrentUid();if(!u)throw new Error("Not authenticated");const p=o.exists()?o.data():null;if(!p||p.owner_uid&&p.owner_uid!==u)throw new Error("Unauthorized");await be(n,{status:a,updated_at:i,completed_at:a==="done"?i:null})}async updateTask(t,a){const i=$.now(),n=V(z,"tasks",t),o={...a,updated_at:i};a.due_date&&(o.due_date=$.fromDate(a.due_date)),Object.keys(o).forEach(y=>{o[y]===void 0&&delete o[y]});const u=await G(n),p=this.getCurrentUid();if(!p)throw new Error("Not authenticated");const k=u.exists()?u.data():null;if(!k||k.owner_uid&&k.owner_uid!==p)throw new Error("Unauthorized");await be(n,o)}async deleteTask(t){const a=V(z,"tasks",t),i=await G(a),n=this.getCurrentUid();if(!n)throw new Error("Not authenticated");const o=i.exists()?i.data():null;if(!o||o.owner_uid&&o.owner_uid!==n)throw new Error("Unauthorized");await Ye(a)}}class ns{constructor(t,a){this.taskRepository=t,this.fileUploadService=a}async completeTask(t){await this.taskRepository.updateStatus(t,"done")}async reopenTask(t){await this.taskRepository.updateStatus(t,"todo")}async updateStatus(t,a){await this.taskRepository.updateStatus(t,a)}async deleteTask(t){try{const a=await this.taskRepository.getTaskById(t);if(a&&a.attachments&&this.fileUploadService)for(const i of a.attachments)try{await this.fileUploadService.deleteFile(i.fileUrl)}catch(n){console.error("Failed to delete attachment for task:",i.fileUrl,n)}try{const i=await this.taskRepository.getSubTasks(t);for(const n of i){if(n&&n.attachments&&this.fileUploadService)for(const o of n.attachments)try{await this.fileUploadService.deleteFile(o.fileUrl)}catch(u){console.error("Failed to delete attachment for subtask:",o.fileUrl,u)}if(n.id)try{await this.taskRepository.deleteTask(n.id)}catch(o){console.error("Failed to delete subtask doc:",n.id,o)}}}catch(i){console.error("Failed to fetch subtasks for deletion:",i)}await this.taskRepository.deleteTask(t)}catch(a){throw console.error("Error deleting task:",a),a}}async uploadTaskFiles(t){if(!this.fileUploadService)throw new Error("FileUploadService is not configured");try{console.log(`[TaskService] Starting file upload for ${t.length} file(s)`);const a=await this.fileUploadService.uploadMultipleFiles(t);return console.log(`[TaskService] File upload successful, got ${a.length} results`),a.map((i,n)=>({id:`attachment_${Date.now()}_${n}`,fileName:i.fileName,fileUrl:i.fileUrl,fileType:i.fileType,uploadedAt:i.uploadedAt}))}catch(a){throw console.error("Error uploading task files:",a),a}}async removeTaskAttachment(t,a,i){try{this.fileUploadService&&await this.fileUploadService.deleteFile(i.fileUrl);const n=await this.taskRepository.getTaskById(t);if(!n)throw new Error("Task not found");const o=n.attachments?.filter(u=>u.id!==a);await this.taskRepository.updateTask(t,{attachments:o})}catch(n){throw console.error("Error removing task attachment:",n),n}}isImageFile(t){if(!this.fileUploadService){const a=["jpg","jpeg","png","gif","webp"],i=t.name.split(".").pop()?.toLowerCase()||"";return t.type.startsWith("image/")||a.includes(i)}return this.fileUploadService.isImageFile(t)}}class os{constructor(){this.storage=Ze(),this.allowedImageMimeTypes=["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/svg+xml","image/bmp","image/x-icon","image/tiff","image/avif"],this.imageExtensions=["jpg","jpeg","png","gif","webp","svg","bmp","ico","tiff","tif","avif"],this.blockedExtensions=["exe","bat","cmd","com","pif","scr","vbs","js","jar","zip","rar","7z"],this.blockedMimeTypes=["application/x-msdownload","application/x-msdos-program","application/x-executable"],this.maxImageSize=5*1024*1024,this.maxAttachmentSize=25*1024*1024,this.maxTotalUploadSize=100*1024*1024}validateFileType(t){const i=t.name.toLowerCase().split(".").pop()||"",n=t.type.toLowerCase();return this.blockedExtensions.includes(i)?{fileName:t.name,reason:`File type "${i}" is not allowed for security reasons`}:this.blockedMimeTypes.some(o=>n.includes(o))?{fileName:t.name,reason:`File MIME type "${n}" is not allowed for security reasons`}:i?null:{fileName:t.name,reason:"File must have a valid extension"}}isImageFile(t){const a=t.type.toLowerCase(),n=t.name.toLowerCase().split(".").pop()||"";return this.allowedImageMimeTypes.includes(a)?!0:this.imageExtensions.includes(n)}getUploadPath(t){return this.isImageFile(t)?"images":"files"}validateFile(t,a=!1){const i=this.validateFileType(t);if(i)return i;const n=a?this.maxImageSize:this.maxAttachmentSize;if(t.size===0)return{fileName:t.name,reason:"File is empty"};if(t.size>n){const o=a?5:25;return{fileName:t.name,reason:`File exceeds ${o}MB size limit (${(t.size/1024/1024).toFixed(2)}MB)`}}return null}validateFilesBatch(t){const a=[];let i=0;for(const n of t){const o=this.isImageFile(n),u=this.validateFile(n,o);u&&a.push(u),i+=n.size}return i>this.maxTotalUploadSize&&a.push({fileName:"Multiple files",reason:`Total upload size exceeds 100MB limit (${(i/1024/1024).toFixed(2)}MB)`}),a}generateUniqueFileName(t){const a=Date.now(),i=Math.random().toString(36).substring(2,9),n=t.name.split(".").pop()||"";return`${(t.name.substring(0,t.name.lastIndexOf("."))||t.name).replace(/[^a-z0-9_-]/gi,"").substring(0,30)}_${a}_${i}.${n}`}async uploadFile(t){try{const a=this.isImageFile(t);console.log(`[FileUploadService] Uploading: ${t.name} (${a?"Image":"File"}) - Size: ${(t.size/1024/1024).toFixed(2)}MB`);const i=this.validateFile(t,a);if(i)throw console.error(`[FileUploadService] Validation failed for ${t.name}: ${i.reason}`),new Error(i.reason);const n=this.getUploadPath(t),o=this.generateUniqueFileName(t),u=`attachements/${n}/${o}`;console.log(`[FileUploadService] Storage path: ${u}`);const p=Se(this.storage,u);console.log("[FileUploadService] Starting upload to Firebase..."),await es(p,t),console.log(`[FileUploadService] Upload complete for ${t.name}`),console.log("[FileUploadService] Getting download URL...");const k=await ss(p);return console.log("[FileUploadService] Got download URL"),{fileName:t.name,fileUrl:k,fileType:t.type,uploadPath:n,uploadedAt:new Date}}catch(a){throw console.error("Error uploading file:",a),new Error(`Failed to upload ${t.name}: ${a.message}`)}}async uploadMultipleFiles(t){try{console.log(`[FileUploadService] Starting batch upload of ${t.length} file(s)`);const a=this.validateFilesBatch(t);if(a.length>0){const n=a.map(o=>`${o.fileName}: ${o.reason}`).join(`
`);throw console.error(`[FileUploadService] Validation errors: ${n}`),new Error(`File validation failed:
${n}`)}const i=[];for(const n of t){const o=await this.uploadFile(n);i.push(o)}return console.log(`[FileUploadService] Batch upload complete: ${i.length} file(s) uploaded`),i}catch(a){throw console.error("Error uploading multiple files:",a),a}}async deleteFile(t){try{const a=t.split("/o/")[1];if(!a)throw new Error("Invalid file URL");const i=decodeURIComponent(a.split("?")[0]),n=Se(this.storage,i);await ts(n)}catch(a){throw console.error("Error deleting file:",a),new Error(`Failed to delete file: ${a.message}`)}}}const I=new is,Te=new os,ie=new ns(I,Te);function hs(){const[j,t]=h.useState([]),[a,i]=h.useState({}),[n,o]=h.useState(!0),[u,p]=h.useState(!1),[k,y]=h.useState(!1),[S,x]=h.useState(!1),[w,f]=h.useState(null),[b,N]=h.useState("all"),[C,T]=h.useState(""),[r,_]=h.useState(new Set),[R,ne]=h.useState(null),[F,W]=h.useState(null),[v,Q]=h.useState({task_name:"",description:"",priority:3,status:"todo",due_date:""}),[_e,M]=h.useState(!1),[L,U]=h.useState([]),[P,E]=h.useState([]),[Ce,A]=h.useState(!1),[Fe,Ue]=h.useState(!1),Ee=h.useMemo(()=>{const s={all:j.length,todo:0,in_progress:0,done:0};for(const l of j){const c=l.id?a[l.id]||[]:[];c.some(d=>d.status==="todo")&&(s.todo+=1),c.some(d=>d.status==="in_progress")&&(s.in_progress+=1),c.some(d=>d.status==="done")&&(s.done+=1)}return s},[j,a]);h.useEffect(()=>{H()},[]),h.useEffect(()=>{const s=()=>Ue(window.innerWidth<=490);return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);async function H(){try{o(!0),console.log("Loading tasks from Firestore...");const s=await I.getMainTasks();console.log("Main tasks loaded:",s),t(s);const l={};for(const c of s)if(c.id){const d=await I.getSubTasks(c.id);l[c.id]=d}i(l)}catch(s){console.error("Error loading tasks:",s),alert("Error loading tasks: "+s.message)}finally{o(!1)}}async function X(s){try{await ie.deleteTask(s),await H()}catch(l){console.error("Error deleting task:",l),alert("Error deleting task: "+l.message)}}function B(s){Q({task_name:"",description:"",priority:3,status:"todo",due_date:""}),M(!1),W(null),U([]),E([]),s?(x(!0),f(s)):(x(!1),f(null)),p(!0)}function oe(){p(!1),M(!1),x(!1),f(null),W(null),U([]),E([])}function J(s){Q({task_name:s.task_name||"",description:s.description||"",priority:s.priority||2,status:s.status||"todo",due_date:s.due_date?s.due_date.seconds?new Date(s.due_date.seconds*1e3).toISOString().slice(0,10):new Date(s.due_date).toISOString().slice(0,10):""}),W(s.id||null),x(s.parent_id!==null&&s.parent_id!==void 0),f(s.parent_id??null),E(s.attachments||[]),U([]),p(!0)}function ze(){y(!1)}function De(s){const{name:l,value:c}=s.target;Q(d=>({...d,[l]:c}))}function $e(s){const l=s.target.files;if(l){const c=Array.from(l);U(d=>[...d,...c])}}function Ie(s){U(l=>l.filter((c,d)=>d!==s))}async function Re(s){const l=P.find(c=>c.id===s);if(F&&l)try{A(!0),await ie.removeTaskAttachment(F,s,l),E(c=>c.filter(d=>d.id!==s))}catch(c){console.error("Error removing attachment:",c),alert("Failed to remove attachment: "+c.message)}finally{A(!1)}else E(c=>c.filter(d=>d.id!==s))}function Me(s){return["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"].includes(s.fileType.toLowerCase())}function Le(s){_(l=>{const c=new Set(l);return c.has(s)?c.delete(s):c.add(s),c})}function le(s){ne(l=>l===s?null:s)}function g(){ne(null)}h.useEffect(()=>{function s(){g()}return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);function re(){let s=j;if(b!=="all"&&(s=s.filter(l=>{const c=l.id?a[l.id]||[]:[];switch(b){case"todo":return c.some(d=>d.status==="todo");case"in_progress":return c.some(d=>d.status==="in_progress");case"done":return c.some(d=>d.status==="done");default:return!0}})),C.trim()){const l=C.toLowerCase();s=s.filter(c=>c.task_name.toLowerCase().includes(l)||c.description&&c.description.toLowerCase().includes(l))}return s}function ce(s){switch(s){case"todo":return{icon:ke,color:"text-slate-400"};case"in_progress":return{icon:je,color:"text-blue-500"};case"done":return{icon:He,color:"text-emerald-500"};default:return{icon:Qe,color:"text-red-500"}}}function de(s){switch(s){case 1:return{color:"text-slate-400",text:"P4"};case 2:return{color:"text-blue-500",text:"P3"};case 3:return{color:"text-orange-500",text:"P2"};case 4:return{color:"text-red-500",text:"P1"};default:return{color:"text-slate-400",text:"P4"}}}function me(s){if(!s)return"No date";const l=s;return(l.seconds?new Date(l.seconds*1e3):new Date(s)).toLocaleDateString("en-US",{month:"short",day:"numeric"})}async function Pe(s){if(s&&s.preventDefault&&s.preventDefault(),M(!0),!(!v.task_name||v.task_name.trim()===""))try{A(!0);let l=[...P];if(L.length>0){console.log(`[task.tsx] Uploading ${L.length} new file(s)`);const d=await ie.uploadTaskFiles(L);console.log(`[task.tsx] Got ${d.length} attachment(s) with URLs`),l=[...P,...d]}const c={task_name:v.task_name.trim(),description:v.description.trim()||void 0,status:v.status,priority:Number(v.priority),due_date:v.due_date?new Date(v.due_date):void 0,parent_id:S&&w?w:void 0,attachments:l.length>0?l:void 0};console.log("Submitting task:",c),console.log(`[task.tsx] Task has ${l.length} attachment(s)`),F?(await I.updateTask(F,c),console.log("Task updated successfully!")):(await I.createTask(c),console.log("Task created successfully!")),await H(),console.log("Tasks reloaded"),M(!1),oe(),y(!0)}catch(l){console.error("Error adding task from modal:",l),alert("Failed to add task: "+l.message+`

Check console for details.`)}finally{A(!1)}}return e.jsxs(Xe,{id:"task",children:[e.jsxs("div",{className:"task-header-section",children:[e.jsxs("div",{className:"header-content",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"header-title",children:"Tasks"}),e.jsx("p",{className:"header-subtitle",children:"Manage your tasks effectively with Taskly"})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{className:"search-container",children:[e.jsx(Oe,{className:"search-icon",size:20}),e.jsx("input",{type:"text",placeholder:"Search tasks...",className:"search-input",value:C,onChange:s=>T(s.target.value)})]}),e.jsx("button",{className:"filter-button",children:e.jsx(Ve,{size:20})}),e.jsxs("button",{className:"new-task-button",onClick:()=>B(),children:[e.jsx(O,{size:20}),"New Task"]})]})]}),e.jsx("div",{className:"filter-tabs",children:[{key:"all",label:"All Tasks"},{key:"todo",label:"To Do"},{key:"in_progress",label:"In Progress"},{key:"done",label:"Done"}].map(s=>e.jsxs("button",{className:`filter-tab ${b===s.key?"active":""}`,onClick:()=>N(s.key),children:[s.label," ","("+(Ee[s.key]??0)+")"]},s.key))})]}),e.jsx("div",{className:"task-list-container",children:n?e.jsxs("div",{className:"loading-state",children:[e.jsx(je,{className:"animate-spin",size:24}),e.jsx("p",{children:"Loading tasks..."})]}):re().length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(ke,{size:48,className:"text-slate-300"}),e.jsx("h3",{children:"No tasks found"}),e.jsx("p",{children:"Get started by creating your first task!"}),e.jsxs("button",{className:"empty-state-button",onClick:()=>B(),children:[e.jsx(O,{size:20}),"Create Task"]})]}):e.jsx("div",{className:"tasks-list",children:re().map(s=>{const l=s.id?a[s.id]||[]:[],c=b==="all"?l:l.filter(m=>m.status===b),d=l.filter(m=>m.status==="done").length,q=c.length>0,ue=s.id?r.has(s.id):!1,he=ce(s.status),K=de(s.priority),Ae=he.icon;return e.jsxs("div",{className:"task-row-container",children:[e.jsxs("div",{className:"task-row",children:[e.jsx("button",{className:"expand-button",onClick:()=>s.id&&q&&Le(s.id),disabled:!q,children:q?ue?e.jsx(Ge,{size:16,className:"text-slate-500"}):e.jsx(We,{size:16,className:"text-slate-500"}):e.jsx("div",{className:"w-4 h-4"})}),e.jsxs("div",{className:"task-content",children:[e.jsx("div",{className:"task-title-row",children:e.jsxs("h3",{className:"task-title",children:[s.task_name,s.id&&l.length>0&&e.jsxs("span",{className:"subtask-pill","aria-label":`${d} of ${l.length} subtasks completed`,children:[d,"/",l.length]})]})}),s.description&&e.jsx("p",{className:"task-description",children:s.description})]}),e.jsxs("div",{className:"status-badge",children:[e.jsx(Ae,{size:16,className:he.color}),e.jsx("span",{className:"status-text",children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"priority-badge",children:[e.jsx(Ne,{size:16,className:K.color}),e.jsx("span",{className:`priority-text ${K.color}`,children:K.text})]}),e.jsxs("div",{className:"due-date",children:[e.jsx(we,{size:16,className:"text-slate-500"}),e.jsx("span",{className:"due-date-text",children:me(s.due_date)})]}),e.jsx("div",{className:"task-actions-dropdown",children:e.jsxs("div",{className:"relative-position",children:[e.jsx("button",{className:"more-actions-button",onClick:m=>{m.stopPropagation(),s.id&&le(s.id)},"aria-expanded":R===s.id,children:e.jsx(ve,{size:16,className:"text-slate-500"})}),R===s.id&&(Fe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mobile-sheet-backdrop",onClick:g}),e.jsxs("div",{className:"mobile-sheet",role:"dialog","aria-modal":"true",onClick:m=>m.stopPropagation(),children:[e.jsx("div",{className:"mobile-sheet-header",children:e.jsx("button",{className:"mobile-sheet-close",onClick:g,"aria-label":"Close",children:"×"})}),e.jsxs("div",{className:"mobile-sheet-content",children:[(s.parent_id===null||s.parent_id===void 0)&&e.jsxs("div",{className:"dropdown-item",onClick:()=>{g(),s.id&&B(s.id)},children:[e.jsx(O,{size:16}),e.jsx("span",{children:"Add Subtask"})]}),e.jsxs("div",{className:"dropdown-item",onClick:()=>{g(),J(s)},children:[e.jsx(ee,{size:16}),e.jsx("span",{children:"Edit Task"})]}),e.jsxs("div",{className:"dropdown-item delete",onClick:()=>{g(),s.id&&X(s.id)},children:[e.jsx(se,{size:16}),e.jsx("span",{children:"Delete Task"})]})]})]})]}):e.jsxs("div",{className:"dropdown-menu",onClick:m=>m.stopPropagation(),children:[(s.parent_id===null||s.parent_id===void 0)&&e.jsxs("div",{className:"dropdown-item",onClick:()=>{g(),s.id&&B(s.id)},children:[e.jsx(O,{size:14}),e.jsx("span",{children:"Add Subtask"})]}),e.jsxs("div",{className:"dropdown-item",onClick:()=>{g(),J(s)},children:[e.jsx(ee,{size:14}),e.jsx("span",{children:"Edit Task"})]}),e.jsxs("div",{className:"dropdown-item delete",onClick:()=>{g(),s.id&&X(s.id)},children:[e.jsx(se,{size:14}),e.jsx("span",{children:"Delete Task"})]})]}))]})})]}),q&&ue&&e.jsxs("div",{className:"subtasks-container",children:[e.jsx("div",{className:"connector-line"}),c.map((m,ls)=>{const pe=ce(m.status),Y=de(m.priority),Be=pe.icon;return e.jsxs("div",{className:"subtask-row",children:[e.jsx("div",{className:"horizontal-connector"}),e.jsxs("div",{className:"subtask-card",children:[e.jsx("div",{className:"expand-button-placeholder"}),e.jsxs("div",{className:"task-content",children:[e.jsx("div",{className:"task-title-row",children:e.jsx("h4",{className:"subtask-title",children:m.task_name})}),m.description&&e.jsx("p",{className:"task-description",children:m.description})]}),e.jsxs("div",{className:"status-badge",children:[e.jsx(Be,{size:16,className:pe.color}),e.jsx("span",{className:"status-text",children:m.status.replace("_"," ")})]}),e.jsxs("div",{className:"priority-badge",children:[e.jsx(Ne,{size:16,className:Y.color}),e.jsx("span",{className:`priority-text ${Y.color}`,children:Y.text})]}),e.jsxs("div",{className:"due-date",children:[e.jsx(we,{size:16,className:"text-slate-500"}),e.jsx("span",{className:"due-date-text",children:me(m.due_date)})]}),e.jsx("div",{className:"task-actions-dropdown",children:e.jsxs("div",{className:"relative-position",children:[e.jsx("button",{className:"more-actions-button",onClick:Z=>{Z.stopPropagation(),m.id&&le(m.id)},"aria-expanded":R===m.id,children:e.jsx(ve,{size:16,className:"text-slate-500"})}),R===m.id&&e.jsxs("div",{className:"dropdown-menu",onClick:Z=>Z.stopPropagation(),children:[e.jsxs("div",{className:"dropdown-item",onClick:()=>{g(),J(m)},children:[e.jsx(ee,{size:14}),e.jsx("span",{children:"Edit Task"})]}),e.jsxs("div",{className:"dropdown-item delete",onClick:()=>{g(),m.id&&X(m.id)},children:[e.jsx(se,{size:14}),e.jsx("span",{children:"Delete Task"})]})]})]})})]})]},m.id)})]})]},s.id)})})}),e.jsx(as,{isOpen:u,showSuccess:k,onClose:oe,onCloseSuccess:ze,onSubmit:Pe,form:v,handleFormChange:De,handleFileSelect:$e,removeFile:Ie,removeAttachment:Re,isImageAttachment:Me,uploadedFiles:L,attachments:P,uploading:Ce,editingTaskId:F,isSubtaskMode:S,showValidationErrors:_e,fileUploadService:Te})]})}export{hs as default};
