import{r as n,j as e}from"./vendor_react-ByBjJ8Oe.js";import{U as x,a as w}from"./index-xBxdPYXT.js";import{o as H,v as T}from"./vendor_firebase-CZSQ0ZSP.js";import"./vendor-DuPUYBON.js";function q(){const[c,m]=n.useState([]),[N,y]=n.useState([]),[b,C]=n.useState(!0),[j,A]=n.useState(null),[v,E]=n.useState(""),[g,L]=n.useState("all"),[p,M]=n.useState("all"),[F,d]=n.useState(!1),[t,o]=n.useState(null),[u,R]=n.useState(null),[S,k]=n.useState(null),[f,U]=n.useState(null);n.useEffect(()=>{let s=!0;const a=()=>{console.log("Fetching users..."),C(!0),x.getAll().then(i=>{console.log("Users fetched",i),s&&(m(i),y(i))}).catch(i=>{console.error("Users fetch error",i),s&&A(i?.message??"Failed to load users")}).finally(()=>{s&&C(!1)})},l=H(w,async i=>{if(console.log("onAuthStateChanged",i),!i)T(w).then(()=>console.log("Anonymous sign-in successful")).catch(h=>console.error("Anonymous sign-in failed",h));else{R(i.uid);try{const h=await x.getById(i.uid);k(h)}catch(h){console.warn("Failed to fetch current user doc",h),k(null)}a()}});return()=>{s=!1,l()}},[]),n.useEffect(()=>{let s=[...c];if(v){const a=v.toLowerCase();s=s.filter(l=>l.displayName?.toLowerCase().includes(a)||l.email?.toLowerCase().includes(a))}g!=="all"&&(s=s.filter(a=>a.role===g)),p!=="all"&&(s=s.filter(a=>a.status===p)),y(s)},[v,g,p,c]);const r=(s,a)=>{U({message:s,type:a}),setTimeout(()=>U(null),3e3)},D=()=>{r("Add user functionality coming soon","success")},B=s=>{o({...s}),d(!0)},$=async()=>{if(t){if(!u){r("Not signed in â€” cannot save changes","error");return}if(u!==t.id&&S?.role!=="admin"){console.warn("Permission denied: current user",u,"cannot edit",t.id),r("You do not have permission to edit this user","error");return}try{const s={};t.displayName!==void 0&&(s.displayName=t.displayName),t.email!==void 0&&(s.email=t.email),t.role!==void 0&&(s.role=t.role),t.department!==void 0&&(s.department=t.department),t.status!==void 0&&(s.status=t.status),t.lastActive!=null&&(s.lastActive=t.lastActive),console.log("ðŸ”„ Updating user in Firestore..."),console.log("User ID:",t.id),console.log("Payload:",JSON.stringify(s,null,2)),await x.update(t.id,s),console.log("âœ… Update successful!");const a=await x.getById(t.id);console.log("ðŸ“¦ Stored user after update:",JSON.stringify(a,null,2)),m(c.map(l=>l.id===t.id?t:l)),r("User updated successfully","success"),d(!1),o(null)}catch(s){console.error("âŒ Failed to update user in Firestore"),console.error("Error:",s),console.error("Error message:",s?.message),console.error("Error code:",s?.code),r(`Failed to update user: ${s?.message||"Unknown error"}`,"error")}}},I=s=>{m(c.map(a=>{if(a.id===s){const l=a.status==="active"?"inactive":"active";return r(`User ${l==="active"?"activated":"deactivated"} successfully`,"success"),{...a,status:l}}return a}))},W=(s,a)=>{window.confirm(`Are you sure you want to delete ${a}? This action cannot be undone.`)&&(m(c.filter(l=>l.id!==s)),r("User deleted successfully","success"))},P=s=>{if(!s)return"?";const a=s.split(" ");return a.length>1?`${a[0][0]}${a[1][0]}`.toUpperCase():s.substring(0,2).toUpperCase()},z=s=>{switch(s){case"admin":return"badge-admin";case"manager":return"badge-manager";default:return"badge-user"}},V=s=>{switch(s){case"active":return"badge-active";case"inactive":return"badge-inactive";case"pending":return"badge-pending";default:return"badge-active"}};return e.jsxs("div",{className:"user-management",children:[f&&e.jsx("div",{className:`notification notification-${f.type}`,children:f.message}),e.jsxs("div",{className:"um-header",children:[e.jsx("h1",{className:"um-title",children:"User Management"}),e.jsxs("button",{className:"btn-primary",onClick:D,children:[e.jsx("span",{className:"btn-icon",children:"+"}),"Add User"]})]}),e.jsxs("div",{className:"um-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("svg",{className:"search-icon",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM19 19l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Search users...",value:v,onChange:s=>E(s.target.value)})]}),e.jsxs("div",{className:"filters",children:[e.jsxs("select",{className:"filter-select",value:g,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"user",children:"User"})]}),e.jsxs("select",{className:"filter-select",value:p,onChange:s=>M(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"Pending"})]})]})]}),b&&e.jsx("div",{className:"loading-state",children:"Loading users..."}),j&&e.jsxs("div",{className:"error-state",children:["Error: ",j]}),!b&&!j&&e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Department"}),e.jsx("th",{children:"Last Active"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"empty-state",children:"No users found matching your criteria"})}):N.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"user-cell",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:s.displayName,className:"user-avatar"}):e.jsx("div",{className:"user-avatar user-avatar-placeholder",children:P(s.displayName||s.email)}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:s.displayName||"No name"}),e.jsx("div",{className:"user-email",children:s.email||"No email"})]})]})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${z(s.role)}`,children:s.role||"user"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${V(s.status)}`,children:s.status||"active"})}),e.jsx("td",{className:"cell-department",children:s.department||"N/A"}),e.jsx("td",{className:"cell-date",children:s.lastActive||"Never"}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"action-btn action-btn-edit",onClick:()=>{if(!u){r("Not signed in","error");return}if(u!==s.id&&S?.role!=="admin"){r("You do not have permission to edit this user","error");return}B(s)},title:"Edit user",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:e.jsx("path",{d:"M11.333 2A1.886 1.886 0 0 1 14 4.667l-9 9-3.667 1 1-3.667 9-9z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("button",{className:"action-btn action-btn-toggle",onClick:()=>I(s.id),title:s.status==="active"?"Deactivate":"Activate",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[e.jsx("path",{d:"M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0z",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M8 8V4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}),e.jsx("button",{className:"action-btn action-btn-delete",onClick:()=>W(s.id,s.displayName||s.email||"this user"),title:"Delete user",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:e.jsx("path",{d:"M2 4h12M5.333 4V2.667a1.333 1.333 0 0 1 1.334-1.334h2.666a1.333 1.333 0 0 1 1.334 1.334V4m2 0v9.333a1.333 1.333 0 0 1-1.334 1.334H4.667a1.333 1.333 0 0 1-1.334-1.334V4h9.334z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]})})]},s.id))})]})}),F&&t&&e.jsx("div",{className:"modal-overlay",onClick:()=>d(!1),children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"modal-title",children:"Edit User"}),e.jsx("button",{className:"modal-close",onClick:()=>d(!1),children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Name"}),e.jsx("input",{type:"text",className:"form-input",value:t.displayName||"",onChange:s=>o({...t,displayName:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{type:"email",className:"form-input",value:t.email||"",onChange:s=>o({...t,email:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Role"}),e.jsxs("select",{className:"form-select",value:t.role||"user",onChange:s=>o({...t,role:s.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Department"}),e.jsxs("select",{className:"form-select",value:t.department||"Engineering",onChange:s=>o({...t,department:s.target.value}),children:[e.jsx("option",{value:"Engineering",children:"Engineering"}),e.jsx("option",{value:"Design",children:"Design"}),e.jsx("option",{value:"Marketing",children:"Marketing"}),e.jsx("option",{value:"Sales",children:"Sales"}),e.jsx("option",{value:"Support",children:"Support"}),e.jsx("option",{value:"HR",children:"HR"}),e.jsx("option",{value:"Finance",children:"Finance"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:t.status||"active",onChange:s=>o({...t,status:s.target.value}),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"Pending"})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:$,children:"Save Changes"})]})]})})]})}export{q as default};
