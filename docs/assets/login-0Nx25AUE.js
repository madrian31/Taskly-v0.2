import{b as p,r as c,j as t}from"./vendor_react-BPssBI41.js";import{S as h,A as n,U as u}from"./index-BEDHFgud.js";import"./vendor-DhMbaX6P.js";import"./vendor_firebase-BpY39YGu.js";function U(){const r=p(),[l,o]=c.useState(!0);c.useEffect(()=>{n.getCurrentUser()?r("/dashboard",{replace:!0}):o(!1)},[r]);const d=async()=>{try{o(!0);const e=await n.signInWithGoogle();if(e&&e.user){const a=e.user.providerData&&e.user.providerData.length>0?e.user.providerData[0].photoURL:void 0,i=e.user.photoURL??a??void 0;try{console.log("Upserting user",{uid:e.user.uid,photo:i,displayName:e.user.displayName}),await u.upsertByUid(e.user.uid,{displayName:e.user.displayName??void 0,email:e.user.email??void 0,photoURL:i})}catch(s){console.error("Failed to upsert user:",s)}try{((await u.getById(e.user.uid))?.status??"active")!=="active"?r("/access-not-available",{replace:!0}):r("/dashboard",{replace:!0})}catch(s){console.error("Error checking user status:",s),r("/dashboard",{replace:!0})}}}catch(e){console.error("Login error:",e),o(!1)}};return l?t.jsx("div",{children:"Loading..."}):t.jsxs(h,{id:"login",children:[t.jsx("h1",{children:"Login"}),t.jsx("p",{children:"Welcome back! Please log in to continue."}),t.jsx("button",{onClick:d,children:"Sign in with Google"})]})}export{U as default};
