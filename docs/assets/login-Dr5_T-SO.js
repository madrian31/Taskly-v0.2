import{b as p,r as n,j as r}from"./vendor_react-CfLwTqu8.js";import{S as h,A as c,U as u}from"./index-CsZqcLvT.js";import"./vendor-DuPUYBON.js";import"./vendor_firebase-CZSQ0ZSP.js";function x(){const s=p(),[l,t]=n.useState(!0);n.useEffect(()=>{(async()=>{try{await c.signOutUser()}catch(i){console.error("Error signing out:",i)}finally{t(!1)}})()},[]);const d=async()=>{try{t(!0);const e=await c.signInWithGoogle();if(e&&e.user){const i=e.user.providerData&&e.user.providerData.length>0?e.user.providerData[0].photoURL:void 0,a=e.user.photoURL??i??void 0;try{console.log("Upserting user",{uid:e.user.uid,photo:a,displayName:e.user.displayName}),await u.upsertByUid(e.user.uid,{displayName:e.user.displayName??void 0,email:e.user.email??void 0,photoURL:a,role:"user"})}catch(o){console.error("Failed to upsert user:",o)}try{const g=(await u.getById(e.user.uid))?.status??"active";s(g!=="active"?"/access-not-available":"/dashboard")}catch(o){console.error("Error checking user status:",o),s("/dashboard")}}}catch(e){console.error("Login error:",e),t(!1)}};return l?r.jsx("div",{children:"Loading..."}):r.jsxs(h,{id:"login",children:[r.jsx("h1",{children:"Login"}),r.jsx("p",{children:"Welcome back! Please log in to continue."}),r.jsx("button",{onClick:d,children:"Sign in with Google"})]})}export{x as default};
