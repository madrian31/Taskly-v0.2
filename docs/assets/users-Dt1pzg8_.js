import{r as l,j as e}from"./vendor_react-BPssBI41.js";import{U as p,a as A}from"./index-D1PoqctQ.js";import{o as z,v as H}from"./vendor_firebase-BpY39YGu.js";import"./vendor-DhMbaX6P.js";function q(){const[x,f]=l.useState([]),[N,y]=l.useState([]),[b,S]=l.useState(!0),[v,w]=l.useState(null),[h,E]=l.useState(""),[m,L]=l.useState("all"),[g,F]=l.useState("all"),[M,c]=l.useState(!1),[a,r]=l.useState(null),[d,R]=l.useState(null),[C,U]=l.useState(null),[j,k]=l.useState(null);l.useEffect(()=>{let s=!0;const t=()=>{console.log("Fetching users..."),S(!0),p.getAll().then(n=>{console.log("Users fetched",n),s&&(f(n),y(n))}).catch(n=>{console.error("Users fetch error",n),s&&w(n?.message??"Failed to load users")}).finally(()=>{s&&S(!1)})},o=z(A,async n=>{if(console.log("onAuthStateChanged",n),!n)H(A).then(()=>console.log("Anonymous sign-in successful")).catch(u=>console.error("Anonymous sign-in failed",u));else{R(n.uid);try{const u=await p.getById(n.uid);U(u)}catch(u){console.warn("Failed to fetch current user doc",u),U(null)}t()}});return()=>{s=!1,o()}},[]),l.useEffect(()=>{let s=[...x];if(h){const t=h.toLowerCase();s=s.filter(o=>o.displayName?.toLowerCase().includes(t)||o.email?.toLowerCase().includes(t))}m!=="all"&&(s=s.filter(t=>t.role===m)),g!=="all"&&(s=s.filter(t=>t.status===g)),y(s)},[h,m,g,x]);const i=(s,t)=>{k({message:s,type:t}),setTimeout(()=>k(null),3e3)},B=()=>{i("Add user functionality coming soon","success")},D=s=>{r({...s}),c(!0)},I=async()=>{if(a){if(!d){i("Not signed in â€” cannot save changes","error");return}if(d!==a.id&&C?.role!=="admin"){console.warn("Permission denied: current user",d,"cannot edit",a.id),i("You do not have permission to edit this user","error");return}try{const s={};a.displayName!==void 0&&(s.displayName=a.displayName),a.email!==void 0&&(s.email=a.email),a.role!==void 0&&(s.role=a.role),a.department!==void 0&&(s.department=a.department),a.status!==void 0&&(s.status=a.status),console.log("ðŸ”„ Updating user in Firestore..."),console.log("User ID:",a.id),console.log("Payload:",JSON.stringify(s,null,2)),await p.update(a.id,s),console.log("âœ… Update successful!");const t=await p.getById(a.id);console.log("ðŸ“¦ Stored user after update:",JSON.stringify(t,null,2)),f(x.map(o=>o.id===a.id?a:o)),i("User updated successfully","success"),c(!1),r(null)}catch(s){console.error("âŒ Failed to update user in Firestore"),console.error("Error:",s),console.error("Error message:",s?.message),console.error("Error code:",s?.code),i(`Failed to update user: ${s?.message||"Unknown error"}`,"error")}}},$=s=>{if(!s)return"?";const t=s.split(" ");return t.length>1?`${t[0][0]}${t[1][0]}`.toUpperCase():s.substring(0,2).toUpperCase()},P=s=>{switch(s){case"admin":return"badge-admin";case"manager":return"badge-manager";default:return"badge-user"}},W=s=>{switch(s){case"active":return"badge-active";case"inactive":return"badge-inactive";case"pending":return"badge-pending";default:return"badge-active"}};return e.jsxs("div",{className:"user-management",children:[j&&e.jsx("div",{className:`notification notification-${j.type}`,children:j.message}),e.jsxs("div",{className:"um-header",children:[e.jsx("h1",{className:"um-title",children:"User Management"}),e.jsxs("button",{className:"btn-primary",onClick:B,children:[e.jsx("span",{className:"btn-icon",children:"+"}),"Add User"]})]}),e.jsxs("div",{className:"um-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("svg",{className:"search-icon",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:e.jsx("path",{d:"M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM19 19l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("input",{type:"text",className:"search-input",placeholder:"Search users...",value:h,onChange:s=>E(s.target.value)})]}),e.jsxs("div",{className:"filters",children:[e.jsxs("select",{className:"filter-select",value:m,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"user",children:"User"})]}),e.jsxs("select",{className:"filter-select",value:g,onChange:s=>F(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"Pending"})]})]})]}),b&&e.jsx("div",{className:"loading-state",children:"Loading users..."}),v&&e.jsxs("div",{className:"error-state",children:["Error: ",v]}),!b&&!v&&e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Department"}),e.jsx("th",{children:"Last Active"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"empty-state",children:"No users found matching your criteria"})}):N.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"user-cell",children:[s.photoURL?e.jsx("img",{src:s.photoURL,alt:s.displayName,className:"user-avatar"}):e.jsx("div",{className:"user-avatar user-avatar-placeholder",children:$(s.displayName||s.email)}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name",children:s.displayName||"No name"}),e.jsx("div",{className:"user-email",children:s.email||"No email"})]})]})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${P(s.role)}`,children:s.role||"user"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${W(s.status)}`,children:s.status||"active"})}),e.jsx("td",{className:"cell-department",children:s.department||"N/A"}),e.jsx("td",{className:"cell-date",children:s.lastActive||"Never"}),e.jsx("td",{children:e.jsx("div",{className:"action-buttons",children:e.jsx("button",{className:"action-btn action-btn-edit",onClick:()=>{if(!d){i("Not signed in","error");return}if(d!==s.id&&C?.role!=="admin"){i("You do not have permission to edit this user","error");return}D(s)},title:"Edit user",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:e.jsx("path",{d:"M11.333 2A1.886 1.886 0 0 1 14 4.667l-9 9-3.667 1 1-3.667 9-9z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})})})]},s.id))})]})}),M&&a&&e.jsx("div",{className:"modal-overlay",onClick:()=>c(!1),children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"modal-title",children:"Edit User"}),e.jsx("button",{className:"modal-close",onClick:()=>c(!1),children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Name"}),e.jsx("input",{type:"text",className:"form-input",value:a.displayName||"",onChange:s=>r({...a,displayName:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{type:"email",className:"form-input",value:a.email||"",onChange:s=>r({...a,email:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Role"}),e.jsxs("select",{className:"form-select",value:a.role||"user",onChange:s=>r({...a,role:s.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Department"}),e.jsxs("select",{className:"form-select",value:a.department||"Engineering",onChange:s=>r({...a,department:s.target.value}),children:[e.jsx("option",{value:"Engineering",children:"Engineering"}),e.jsx("option",{value:"Design",children:"Design"}),e.jsx("option",{value:"Marketing",children:"Marketing"}),e.jsx("option",{value:"Sales",children:"Sales"}),e.jsx("option",{value:"Support",children:"Support"}),e.jsx("option",{value:"HR",children:"HR"}),e.jsx("option",{value:"Finance",children:"Finance"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-select",value:a.status||"active",onChange:s=>r({...a,status:s.target.value}),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"Pending"})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>c(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:I,children:"Save Changes"})]})]})})]})}export{q as default};
