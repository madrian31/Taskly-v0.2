import{u as p,r as s,j as e}from"./vendor_react-ByBjJ8Oe.js";import{A as a,S as h}from"./index-DnoBwBuG.js";import{U as g}from"./UsersRepository-pbQkWHpB.js";import"./vendor-DuPUYBON.js";import"./vendor_firebase-i8bcTDRB.js";function y(){const t=p(),[n,d]=s.useState(!0);s.useEffect(()=>{const o=a.onAuthStateChanged(r=>{r&&t("/dashboard"),d(!1)});return()=>o()},[t]);const u=async()=>{try{const o=await a.signInWithGoogle();if(o&&o.user){const r=o.user.providerData&&o.user.providerData.length>0?o.user.providerData[0].photoURL:void 0,i=o.user.photoURL??r??void 0;try{console.log("Upserting user",{uid:o.user.uid,photo:i,displayName:o.user.displayName}),await g.upsertByUid(o.user.uid,{displayName:o.user.displayName??void 0,email:o.user.email??void 0,photoURL:i,role:"user"})}catch(c){console.error("Failed to upsert user:",c)}const l=`${window.location.origin}${window.location.pathname}?reload=1&newUser=1#/dashboard`;window.location.href=l}}catch(o){console.error(o)}};return n?e.jsx("div",{children:"Loading..."}):e.jsxs(h,{id:"login",children:[e.jsx("h1",{children:"Login"}),e.jsx("p",{children:"Welcome back! Please log in to continue."}),e.jsx("button",{onClick:u,children:"Sign in with Google"})]})}export{y as default};
