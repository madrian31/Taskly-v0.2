import{u as h,r as a,j as t}from"./vendor_react-DAGpP-PG.js";import{A as n,U as c,S as p}from"./index-DWL_lDMM.js";import"./vendor-DuPUYBON.js";import"./vendor_firebase-CZSQ0ZSP.js";function y(){const o=h(),[u,d]=a.useState(!0);a.useEffect(()=>{const e=n.onAuthStateChanged(async s=>{if(s)try{const i=(await c.getById(s.uid))?.status??"active";o(i==="active"?"/dashboard":"/access-not-available")}catch(r){console.error("Login: failed to fetch user document",r),o("/dashboard")}d(!1)});return()=>e()},[o]);const l=async()=>{try{const e=await n.signInWithGoogle();if(e&&e.user){const s=e.user.providerData&&e.user.providerData.length>0?e.user.providerData[0].photoURL:void 0,r=e.user.photoURL??s??void 0;try{console.log("Upserting user",{uid:e.user.uid,photo:r,displayName:e.user.displayName}),await c.upsertByUid(e.user.uid,{displayName:e.user.displayName??void 0,email:e.user.email??void 0,photoURL:r,role:"user"})}catch(i){console.error("Failed to upsert user:",i)}o("/dashboard")}}catch(e){console.error(e)}};return u?t.jsx("div",{children:"Loading..."}):t.jsxs(p,{id:"login",children:[t.jsx("h1",{children:"Login"}),t.jsx("p",{children:"Welcome back! Please log in to continue."}),t.jsx("button",{onClick:l,children:"Sign in with Google"})]})}export{y as default};
