import{u as U,r as i,j as e,L as N,O as k}from"./vendor_react-ByBjJ8Oe.js";import{A as v,U as y}from"./index-iTxVkW6Q.js";import"./vendor-DuPUYBON.js";import"./vendor_firebase-CZSQ0ZSP.js";const S=[{sortOrder:1,name:"Dashboard",icon:"",link:"/dashboard",role:"everyone"},{sortOrder:8,name:"Tasks",icon:"",link:"/task",role:"everyone"},{sortOrder:16,name:"Calendar",icon:"",link:"/calendar",role:"everyone"},{sortOrder:24,name:"Users",icon:"",link:"/users",role:"admin"},{sortOrder:32,name:"Settings",icon:"",link:"/settings",role:"admin"},{sortOrder:99,name:"Logout",icon:"",action:"logout",role:"everyone"}];function L(n){return S.filter(t=>t.role==="everyone"||t.role===n)}function O({photoURL:n,name:t,size:s=80,bgColor:l="#667eea"}={}){return n||`https://ui-avatars.com/api/?name=${encodeURIComponent(t||"User")}&background=${l.replace("#","")}&color=fff&size=${s}`}function R({children:n}){const t=U(),[s,l]=i.useState(!1),[h,m]=i.useState(null),[D,p]=i.useState(null),[b,c]=i.useState(null),[x,d]=i.useState("user");i.useEffect(()=>{const o=v.onAuthStateChanged(async r=>{if(r){m(r.displayName||r.email||"User"),p(r.email||"");try{const a=await y.getById(r.uid);if(console.log("Sidebar auth user:",r),console.log("Sidebar providerData:",r.providerData),console.log("Sidebar userDoc from Firestore:",a),a&&a.photoURL)c(a.photoURL);else{const u=r.providerData&&r.providerData.length>0?r.providerData[0].photoURL:void 0;c(r.photoURL??u??null)}a&&a.role?d(a.role):d("user")}catch(a){console.error("Failed to fetch user document:",a);const u=r.providerData&&r.providerData.length>0?r.providerData[0].photoURL:void 0;c(r.photoURL??u??null)}}else m(null),p(null),c(null),d("user")});return()=>o()},[]);const f=async()=>{try{await v.signOutUser(),t("/login")}catch(o){console.error("Logout failed:",o)}},j=()=>{l(!s)},g=()=>{l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`hamburger-btn ${s?"hamburger-open":""}`,onClick:j,"aria-expanded":s,"aria-label":s?"Close sidebar":"Open sidebar",children:e.jsx("i",{className:"bi bi-list"})}),s&&e.jsx("div",{className:"sidebar-overlay",onClick:g}),e.jsxs("aside",{className:`sidebar ${s?"sidebar-open":""}`,children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h2",{children:"Tasky"}),e.jsxs("div",{className:"user-profile",children:[e.jsx("div",{className:"user-avatar",children:e.jsx("img",{id:"userPhoto",src:O({photoURL:b,name:h||"User",size:80,bgColor:"#3498db"}),alt:"Profile"})}),e.jsx("div",{className:"user-info",children:e.jsx("h5",{id:"userName",children:h??"Loading..."})})]})]}),e.jsx("ul",{children:L(x).map(o=>e.jsx("li",{children:o.link?e.jsxs(N,{to:o.link,onClick:g,children:[o.icon&&e.jsx("span",{className:"material-icons",children:o.icon}),o.name]}):o.action==="logout"?e.jsxs("button",{onClick:f,className:"logout-btn",children:[o.icon&&e.jsx("span",{className:"material-icons",children:o.icon}),o.name]}):null},o.link||o.action))}),n]})]})}function A(){return e.jsxs("div",{className:"main-layout-container",children:[e.jsx(R,{}),e.jsx("main",{className:"main-content",children:e.jsx(k,{})})]})}export{A as default};
