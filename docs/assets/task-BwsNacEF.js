import{r as l,j as e,S as je,F as fe,P as q,C as ee,b as se,d as Ne,e as ye,f as ae,g as te,E as ne,h as ie,T as oe,i as ve,k as ge}from"./vendor_react-DRoQELJT.js";/* empty css            */import{d as k,S as be}from"./index-BSXmaucF.js";import{c as we,d as B,q as Se,w as _e,e as _,f as Te,T as j,h as Ce,u as le,j as De}from"./vendor_firebase-CsWAWMrr.js";import"./vendor-DuPUYBON.js";class Ee{constructor(){this.ref=we(k,"tasks")}async getAllTasks(){return(await B(this.ref)).docs.map(n=>({id:n.id,...n.data()}))}async getMainTasks(){return(await B(this.ref)).docs.map(n=>({id:n.id,...n.data()})).filter(n=>n.parent_id===null||n.parent_id===void 0)}async getSubTasks(a){const n=Se(this.ref,_e("parent_id","==",a));return(await B(n)).docs.map(u=>({id:u.id,...u.data()}))}async getTaskById(a){const n=_(k,"tasks",a),d=await Te(n);return d.exists()?{id:d.id,...d.data()}:null}async createTask(a){if(a.priority<1||a.priority>4)throw new Error("Priority must be between 1 and 4");const n=j.now();await Ce(this.ref,{task_name:a.task_name,description:a.description??null,parent_id:a.parent_id??null,status:a.status??"todo",priority:a.priority,due_date:a.due_date?j.fromDate(a.due_date):null,created_at:n,updated_at:n,completed_at:a.status==="done"?n:null})}async updateStatus(a,n){if(!["todo","in_progress","blocked","done"].includes(n))throw new Error("Invalid status value");const d=j.now(),u=_(k,"tasks",a);await le(u,{status:n,updated_at:d,completed_at:n==="done"?d:null})}async updateTask(a,n){const d=j.now(),u=_(k,"tasks",a),m={...n,updated_at:d};n.due_date&&(m.due_date=j.fromDate(n.due_date)),Object.keys(m).forEach(N=>{m[N]===void 0&&delete m[N]}),await le(u,m)}async deleteTask(a){await De(_(k,"tasks",a))}}class ze{constructor(a){this.taskRepository=a}async completeTask(a){await this.taskRepository.updateStatus(a,"done")}async reopenTask(a){await this.taskRepository.updateStatus(a,"todo")}async updateStatus(a,n){await this.taskRepository.updateStatus(a,n)}async deleteTask(a){await this.taskRepository.deleteTask(a)}}const f=new Ee,Pe=new ze(f);function qe(){const[T,a]=l.useState([]),[n,d]=l.useState({}),[u,m]=l.useState(!0),[N,C]=l.useState(!1),[re,O]=l.useState(!1),[c,y]=l.useState(!1),[V,v]=l.useState(null),[D,de]=l.useState("all"),[E,ce]=l.useState(""),[ue,me]=l.useState(new Set),[g,W]=l.useState(null),[b,z]=l.useState(null),[r,P]=l.useState({task_name:"",description:"",priority:3,status:"todo",due_date:""}),[pe,w]=l.useState(!1);l.useEffect(()=>{I()},[]);async function I(){try{m(!0),console.log("Loading tasks from Firestore...");const s=await f.getMainTasks();console.log("Main tasks loaded:",s),a(s);const t={};for(const i of s)if(i.id){const x=await f.getSubTasks(i.id);t[i.id]=x}d(t)}catch(s){console.error("Error loading tasks:",s),alert("Error loading tasks: "+s.message)}finally{m(!1)}}async function $(s){try{await Pe.deleteTask(s),await I()}catch(t){console.error("Error deleting task:",t),alert("Error deleting task: "+t.message)}}function M(s){P({task_name:"",description:"",priority:3,status:"todo",due_date:""}),w(!1),z(null),s?(y(!0),v(s)):(y(!1),v(null)),C(!0)}function S(){C(!1),w(!1),y(!1),v(null),z(null)}function Q(s){P({task_name:s.task_name||"",description:s.description||"",priority:s.priority||2,status:s.status||"todo",due_date:s.due_date?s.due_date.seconds?new Date(s.due_date.seconds*1e3).toISOString().slice(0,10):new Date(s.due_date).toISOString().slice(0,10):""}),z(s.id||null),y(s.parent_id!==null&&s.parent_id!==void 0),v(s.parent_id??null),C(!0)}function A(){O(!1)}function h(s){const{name:t,value:i}=s.target;P(x=>({...x,[t]:i}))}function xe(s){me(t=>{const i=new Set(t);return i.has(s)?i.delete(s):i.add(s),i})}function U(s){W(t=>t===s?null:s)}function p(){W(null)}l.useEffect(()=>{function s(){p()}return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);function G(){let s=T;if(D!=="all"&&(s=s.filter(t=>{switch(D){case"todo":return t.status==="todo";case"in_progress":return t.status==="in_progress";case"done":return t.status==="done";default:return!0}})),E.trim()){const t=E.toLowerCase();s=s.filter(i=>i.task_name.toLowerCase().includes(t)||i.description&&i.description.toLowerCase().includes(t))}return s}function H(s){switch(s){case"todo":return{icon:se,color:"text-slate-400"};case"in_progress":return{icon:ee,color:"text-blue-500"};case"done":return{icon:ge,color:"text-emerald-500"};default:return{icon:ve,color:"text-red-500"}}}function J(s){switch(s){case 1:return{color:"text-slate-400",text:"P4"};case 2:return{color:"text-blue-500",text:"P3"};case 3:return{color:"text-orange-500",text:"P2"};case 4:return{color:"text-red-500",text:"P1"};default:return{color:"text-slate-400",text:"P4"}}}function K(s){if(!s)return"No date";const t=s;return(t.seconds?new Date(t.seconds*1e3):new Date(s)).toLocaleDateString("en-US",{month:"short",day:"numeric"})}async function X(s){if(s&&s.preventDefault&&s.preventDefault(),w(!0),!(!r.task_name||r.task_name.trim()===""))try{const t={task_name:r.task_name.trim(),description:r.description.trim()||void 0,status:r.status,priority:Number(r.priority),due_date:r.due_date?new Date(r.due_date):void 0,parent_id:c&&V?V:void 0};console.log("Submitting task:",t),b?(await f.updateTask(b,t),console.log("Task updated successfully!")):(await f.createTask(t),console.log("Task created successfully!")),await I(),console.log("Tasks reloaded"),w(!1),S(),O(!0)}catch(t){console.error("Error adding task from modal:",t),alert("Failed to add task: "+t.message+`

Check console for details.`)}}return e.jsxs(be,{id:"task",children:[e.jsxs("div",{className:"task-header-section",children:[e.jsxs("div",{className:"header-content",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"header-title",children:"Tasks"}),e.jsx("p",{className:"header-subtitle",children:"Manage your tasks effectively with Taskly"})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("div",{className:"search-container",children:[e.jsx(je,{className:"search-icon",size:20}),e.jsx("input",{type:"text",placeholder:"Search tasks...",className:"search-input",value:E,onChange:s=>ce(s.target.value)})]}),e.jsx("button",{className:"filter-button",children:e.jsx(fe,{size:20})}),e.jsxs("button",{className:"new-task-button",onClick:()=>M(),children:[e.jsx(q,{size:20}),"New Task"]})]})]}),e.jsx("div",{className:"filter-tabs",children:[{key:"all",label:"All Tasks"},{key:"todo",label:"To Do"},{key:"in_progress",label:"In Progress"},{key:"done",label:"Done"}].map(s=>e.jsx("button",{className:`filter-tab ${D===s.key?"active":""}`,onClick:()=>de(s.key),children:s.label},s.key))})]}),e.jsx("div",{className:"task-list-container",children:u?e.jsxs("div",{className:"loading-state",children:[e.jsx(ee,{className:"animate-spin",size:24}),e.jsx("p",{children:"Loading tasks..."})]}):G().length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(se,{size:48,className:"text-slate-300"}),e.jsx("h3",{children:"No tasks found"}),e.jsx("p",{children:"Get started by creating your first task!"}),e.jsxs("button",{className:"empty-state-button",onClick:()=>M(),children:[e.jsx(q,{size:20}),"Create Task"]})]}):e.jsx("div",{className:"tasks-list",children:G().map(s=>{const t=s.id?n[s.id]||[]:[],i=t.length>0,x=s.id?ue.has(s.id):!1,Y=H(s.status),L=J(s.priority),he=Y.icon;return e.jsxs("div",{className:"task-row-container",children:[e.jsxs("div",{className:"task-row",children:[e.jsx("button",{className:"expand-button",onClick:()=>s.id&&i&&xe(s.id),disabled:!i,children:i?x?e.jsx(Ne,{size:16,className:"text-slate-500"}):e.jsx(ye,{size:16,className:"text-slate-500"}):e.jsx("div",{className:"w-4 h-4"})}),e.jsxs("div",{className:"task-content",children:[e.jsx("div",{className:"task-title-row",children:e.jsx("h3",{className:"task-title",children:s.task_name})}),s.description&&e.jsx("p",{className:"task-description",children:s.description})]}),e.jsxs("div",{className:"status-badge",children:[e.jsx(he,{size:16,className:Y.color}),e.jsx("span",{className:"status-text",children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"priority-badge",children:[e.jsx(ae,{size:16,className:L.color}),e.jsx("span",{className:`priority-text ${L.color}`,children:L.text})]}),e.jsxs("div",{className:"due-date",children:[e.jsx(te,{size:16,className:"text-slate-500"}),e.jsx("span",{className:"due-date-text",children:K(s.due_date)})]}),e.jsx("div",{className:"task-actions-dropdown",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{className:"more-actions-button",onClick:o=>{o.stopPropagation(),s.id&&U(s.id)},"aria-expanded":g===s.id,children:e.jsx(ne,{size:16,className:"text-slate-500"})}),g===s.id&&e.jsxs("div",{className:"dropdown-menu",onClick:o=>o.stopPropagation(),children:[(s.parent_id===null||s.parent_id===void 0)&&e.jsxs("div",{className:"dropdown-item",onClick:()=>{p(),s.id&&M(s.id)},children:[e.jsx(q,{size:14}),e.jsx("span",{children:"Add Subtask"})]}),e.jsxs("div",{className:"dropdown-item",onClick:()=>{p(),Q(s)},children:[e.jsx(ie,{size:14}),e.jsx("span",{children:"Edit Task"})]}),e.jsxs("div",{className:"dropdown-item delete",onClick:()=>{p(),s.id&&$(s.id)},children:[e.jsx(oe,{size:14}),e.jsx("span",{children:"Delete Task"})]})]})]})})]}),i&&x&&e.jsxs("div",{className:"subtasks-container",children:[e.jsx("div",{className:"connector-line"}),t.map((o,Ie)=>{const Z=H(o.status),F=J(o.priority),ke=Z.icon;return e.jsxs("div",{className:"subtask-row",children:[e.jsx("div",{className:"horizontal-connector"}),e.jsxs("div",{className:"subtask-card",children:[e.jsx("div",{className:"expand-button-placeholder"}),e.jsxs("div",{className:"task-content",children:[e.jsx("div",{className:"task-title-row",children:e.jsx("h4",{className:"subtask-title",children:o.task_name})}),o.description&&e.jsx("p",{className:"task-description",children:o.description})]}),e.jsxs("div",{className:"status-badge",children:[e.jsx(ke,{size:16,className:Z.color}),e.jsx("span",{className:"status-text",children:o.status.replace("_"," ")})]}),e.jsxs("div",{className:"priority-badge",children:[e.jsx(ae,{size:16,className:F.color}),e.jsx("span",{className:`priority-text ${F.color}`,children:F.text})]}),e.jsxs("div",{className:"due-date",children:[e.jsx(te,{size:16,className:"text-slate-500"}),e.jsx("span",{className:"due-date-text",children:K(o.due_date)})]}),e.jsx("div",{className:"task-actions-dropdown",children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx("button",{className:"more-actions-button",onClick:R=>{R.stopPropagation(),o.id&&U(o.id)},"aria-expanded":g===o.id,children:e.jsx(ne,{size:16,className:"text-slate-500"})}),g===o.id&&e.jsxs("div",{className:"dropdown-menu",onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{className:"dropdown-item",onClick:()=>{p(),Q(o)},children:[e.jsx(ie,{size:14}),e.jsx("span",{children:"Edit Task"})]}),e.jsxs("div",{className:"dropdown-item delete",onClick:()=>{p(),o.id&&$(o.id)},children:[e.jsx(oe,{size:14}),e.jsx("span",{children:"Delete Task"})]})]})]})})]})]},o.id)})]})]},s.id)})})}),N&&e.jsx("div",{className:"task-modal-overlay",onClick:S,children:e.jsxs("div",{className:"task-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"task-modal-header",children:[e.jsx("h2",{className:"task-modal-title",children:b?c?"Edit Subtask":"Edit Task":c?"Add New Subtask":"Add New Task"}),e.jsx("button",{className:"task-modal-close-btn",type:"button",onClick:S,"aria-label":"Close modal",children:"×"})]}),e.jsx("div",{className:"task-modal-body",children:e.jsxs("form",{id:"taskForm",onSubmit:X,children:[e.jsxs("div",{className:"task-form-group",children:[e.jsxs("label",{className:"task-form-label",children:[c?"Subtask Name":"Task Name",e.jsx("span",{style:{color:"#dc2626"},children:"*"})]}),e.jsx("input",{type:"text",className:"task-input-field",name:"task_name",id:"taskName",placeholder:c?"Enter subtask name":"Enter task name",value:r.task_name,onChange:h,required:!0}),e.jsx("div",{className:"task-error-message",id:"taskNameError",style:{display:pe&&!r.task_name?"block":"none"},children:c?"Subtask name is required":"Task name is required"})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Description"}),e.jsx("textarea",{className:"task-input-field",id:"taskDescription",name:"description",placeholder:"Add a description (optional)",value:r.description,onChange:h})]}),e.jsxs("div",{className:"task-form-row",children:[e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Status"}),e.jsxs("select",{className:"task-input-field",id:"taskStatus",name:"status",value:r.status,onChange:h,children:[e.jsx("option",{value:"todo",children:"Todo"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"done",children:"Done"})]})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsxs("label",{className:"task-form-label task-priority-label-header",children:["Priority",e.jsx("span",{className:"task-info-icon",children:"i"})]}),e.jsxs("select",{className:"task-input-field",id:"taskPriority",name:"priority",value:r.priority,onChange:h,children:[e.jsx("option",{value:1,children:"Low"}),e.jsx("option",{value:2,children:"Medium"}),e.jsx("option",{value:3,children:"High"}),e.jsx("option",{value:4,children:"Urgent"})]})]})]}),e.jsxs("div",{className:"task-form-group",children:[e.jsx("label",{className:"task-form-label",children:"Due Date"}),e.jsx("input",{type:"date",className:"task-input-field",id:"taskDueDate",name:"due_date",value:r.due_date,onChange:h})]})]})}),e.jsxs("div",{className:"task-modal-footer",children:[e.jsx("button",{type:"button",className:"task-btn task-btn-cancel",onClick:S,children:"Cancel"}),e.jsx("button",{type:"button",className:"task-btn task-btn-primary",onClick:X,children:b?c?"Save Subtask":"Save Task":c?"Add Subtask":"Add Task"})]})]})}),re&&e.jsx("div",{className:"task-modal-overlay",onClick:A,children:e.jsxs("div",{className:"task-modal",onClick:s=>s.stopPropagation(),style:{maxWidth:"400px",textAlign:"center"},children:[e.jsx("div",{className:"task-modal-header",style:{borderBottom:"none",justifyContent:"flex-end",padding:"12px 16px"},children:e.jsx("button",{className:"task-modal-close-btn",type:"button",onClick:A,"aria-label":"Close modal",children:"×"})}),e.jsxs("div",{className:"task-modal-body",style:{padding:"20px 32px 32px"},children:[e.jsx("div",{style:{width:"80px",height:"80px",margin:"0 auto 24px",borderRadius:"50%",background:"linear-gradient(135deg, rgba(124,58,237,0.1), rgba(124,58,237,0.05))",display:"flex",alignItems:"center",justifyContent:"center",border:"3px solid #7c3aed"},children:e.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"#7c3aed",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("h2",{style:{fontSize:"1.5rem",color:"#0f172a",marginBottom:"12px",fontWeight:"600"},children:"Awesome!"}),e.jsxs("p",{style:{color:"#64748b",fontSize:"0.95rem",marginBottom:"28px"},children:[c?"Subtask":"Task"," successfully added to your list"]}),e.jsx("button",{type:"button",className:"task-btn task-btn-primary",onClick:A,style:{width:"100%",padding:"12px",fontSize:"1rem"},children:"Continue"})]})]})})]})}export{qe as default};
